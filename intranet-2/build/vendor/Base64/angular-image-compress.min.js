"use strict";!function(e,t,i){t.module("ngImageCompress",[]).directive("ngImageCompress",["$q",function(t){var i=e.URL||e.webkitURL,a=function(e){var i=t.defer(),a=new FileReader;return a.onload=function(e){i.resolve(e.target.result)},a.readAsDataURL(e),i.promise};return{restrict:"A",scope:{image:"=",resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(e,t,n){var r=function(t,i){!function(e,t){var i=new Image;i.onload=function(){t(i)},i.src=e}(t.url,function(a){var n=function(e,t){var i=t.resizeType,a=100*t.resizeQuality||70,n="image/jpeg";void 0!==i&&"png"===i&&(n="image/png");var r=t.resizeMaxHeight||300,o=t.resizeMaxWidth||250,u=e.height,c=e.width;c>u?c>o&&(u=Math.round(u*=o/c),c=o):u>r&&(c=Math.round(c*=r/u),u=r);var s=document.createElement("canvas");s.width=c,s.height=u;s.getContext("2d").drawImage(e,0,0,c,u);var g=s.toDataURL(n,a/100),d=new Image;return d.src=g,d.src}(a,e);t.compressed={dataURL:n,type:n.match(/:(.+\/.+);/)[1]},i(t)})},o=function(t){e.$apply(function(){n.multiple?e.image.push(t):e.image=t})};t.bind("change",function(t){n.multiple&&(e.image=[]);for(var u=t.target.files,c=0;c<u.length;c++){var s={file:u[c],url:i.createObjectURL(u[c])};a(u[c]).then(function(e){s.dataURL=e}),e.resizeMaxHeight||e.resizeMaxWidth?r(s,function(e){o(e)}):o(s)}})}}}])}(window,window.angular);