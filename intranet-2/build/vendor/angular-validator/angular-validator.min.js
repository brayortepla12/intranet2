(function(){var r;r=angular.element,angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,o,i){var a,s,u,c,l,d,f,v,h,p;return s=e.get("$validator"),a=e.get("$parse"),c=a(o.ngModel),h=[],p=function(r,a){var s,u,l,d,f,v,p;if(null==a&&(a={}),p=0,s=0,d=function(){var r,s;if(++p>=h.length){for(i.$setValidity(o.ngModel,!0),r=0,s=h.length;r<s;r++)h[r].success(c(t),t,n,o,e);"function"==typeof a.success&&a.success()}},0===h.length)return d();for(u=function(r){return r.validator(c(t),t,n,o,{success:function(){return d()},error:function(){var u,l;if(r.enableError&&1==++s&&(i.$setValidity(o.ngModel,!1),r.error(c(t),t,n,o,e)),1===("function"==typeof a.error?a.error():void 0)){try{n[0].scrollIntoViewIfNeeded()}catch(r){}return n[0].select?"function"==typeof(u=n[0]).select?u.select():void 0:"function"==typeof(l=n[0]).focus?l.focus():void 0}}})},l=0,f=h.length;l<f;l++){switch(v=h[l],r){case"blur":if("blur"!==v.invoke)continue;v.enableError=!0;break;case"watch":if("watch"!==v.invoke&&!v.enableError){d();continue}break;case"broadcast":v.enableError=!0}u(v)}},f=function(){var r;return null==(r=s.getRule("required"))&&(r=s.convertRule("required",{validator:/^.+$/,invoke:"watch"})),h.push(r)},v=function(r){var i,a,s,u,l;for(l=[],a=i=0,s=h.length;i<s;a=i+=1)(null!=(u=h[a])?u.name:void 0)===r&&(h[a].success(c(t),t,n,o,e),h.splice(a,1),l.push(a--));return l},o.$observe("validator",function(r){var i,a,u,c,d,v,p;if(h.length=0,(l.validatorRequired||l.required)&&f(),u=r.match(/^\/(.*)\/$/))return v=s.convertRule("dynamic",{validator:RegExp(u[1]),invoke:o.validatorInvoke,error:o.validatorError}),void h.push(v);if(u=r.match(/^\[(.+)\]$/)){for(d=[],i=0,a=(p=u[1].split(",")).length;i<a;i++)c=p[i],"function"==typeof(v=s.getRule(c.replace(/^\s+|\s+$/g,""))).init&&v.init(t,n,o,e),v?d.push(h.push(v)):d.push(void 0);return d}}),o.$observe("validatorError",function(r){var e,t;if(e=o.validator.match(/^\/(.*)\/$/))return v("dynamic"),t=s.convertRule("dynamic",{validator:RegExp(e[1]),invoke:o.validatorInvoke,error:r}),h.push(t)}),l={validatorRequired:!1,required:!1},o.$observe("validatorRequired",function(r){return r&&"false"!==r?(f(),l.validatorRequired=!0):l.validatorRequired?(v("required"),l.validatorRequired=!1):void 0}),o.$observe("required",function(r){return r&&"false"!==r?(f(),l.required=!0):l.required?(v("required"),l.required=!1):void 0}),u=function(r,e){var n,i,s,u;return!e||(o.validatorGroup===e||(r.targetScope===t?0===o.ngModel.indexOf(e):(n=function(r,e){var t,o;for(t in r)switch(typeof(o=r[t])){case"string":if("$$hashKey"===t&&o===e)return!0;break;case"object":if(n(o,e))return!0}return!1},s=(i=o.ngModel.indexOf("."))>=0?o.ngModel.substr(0,i):o.ngModel,null!=(u=a(s)(t))&&n(a(e)(r.targetScope),u.$$hashKey))))},t.$on(s.broadcastChannel.prepare,function(r,e){if(u(r,e.model))return e.accept()}),t.$on(s.broadcastChannel.start,function(r,e){if(u(r,e.model))return p("broadcast",{success:e.success,error:e.error})}),t.$on(s.broadcastChannel.reset,function(r,a){var s,l,d;if(u(r,a.model)){for(s=0,l=h.length;s<l;s++)(d=h[s]).success(c(t),t,n,o,e),"watch"!==d.invoke&&(d.enableError=!1);return i.$setValidity(o.ngModel,!0)}}),t.$watch(o.ngModel,function(r,e){if(r!==e)return p("watch",{oldValue:e})}),d=function(){return t.$root.$$phase?p("blur"):t.$apply(function(){return p("blur")})},r(n).bind("blur",d),t.$on("$destroy",function(){return r(n).unbind("blur",d)})}}}])}).call(this),function(){angular.module("validator",["validator.directive"])}.call(this),function(){var r;r=angular.element,angular.module("validator.provider",[]).provider("$validator",function(){var e,t,n,o;e=null,t=null,n=null,this.rules={},this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"},this.setupProviders=function(r){return t=(e=r).get("$q"),n=e.get("$timeout")},this.convertError=function(e){var t;return"function"==typeof e?e:(t=e.constructor===String?e:"",function(e,n,o,i){var a,s,u,c,l,d;if((l=o.closest(".form-group")).length){for(l.addClass("has-error"),s=0,c=(d=l.find("label")).length;s<c;s++)u=d[s],r(u).hasClass("error")&&r(u).remove();return a=r("<label class='control-label error'>"+t+"</label>"),i.id&&a.attr("for",i.id),o.parent().hasClass("input-group")?o.parent().parent().append(a):o.parent().append(a)}})},this.convertSuccess=function(e){return"function"==typeof e?e:function(e,t,n){var o,i,a,s,u,c;for(s=n.parent(),c=[];0!==s.length;){if(s.hasClass("has-error")){for(s.removeClass("has-error"),o=0,a=(u=s.find("label")).length;o<a;o++)i=u[o],r(i).hasClass("error")&&r(i).remove();break}c.push(s=s.parent())}return c}},this.convertValidator=function(r){var n,o,i;return i=function(){},r.constructor===RegExp?(o=r,i=function(r,e,t,n,i){return null==r&&(r=""),o.test(r)?"function"==typeof i.success?i.success():void 0:"function"==typeof i.error?i.error():void 0}):"function"==typeof r&&(n=r,i=function(r,o,i,a,s){return t.all([n(r,o,i,a,e)]).then(function(r){return r&&r.length>0&&r[0]?"function"==typeof s.success?s.success():void 0:"function"==typeof s.error?s.error():void 0},function(){return"function"==typeof s.error?s.error():void 0})}),i},this.convertRule=(o=this,function(r,e){var t,n,i;return null==e&&(e={}),(i={name:r,enableError:"watch"===e.invoke,invoke:e.invoke,init:e.init,validator:null!=(t=e.validator)?t:function(){return!0},error:null!=(n=e.error)?n:"",success:e.success}).error=o.convertError(i.error),i.success=o.convertSuccess(i.success),i.validator=o.convertValidator(i.validator),i}),this.register=function(r,e){return null==e&&(e={}),this.rules[r]=this.convertRule(r,e)},this.getRule=function(r){return this.rules[r]?angular.copy(this.rules[r]):null},this.validate=function(r){return function(o,i){var a,s,u,c,l;return u=t.defer(),l=u.promise,s={total:0,success:0,error:0},c={promises:{success:[],error:[],then:[]},accept:function(){return s.total++},validatedSuccess:function(){var r,e,t,n,o,i;if(++s.success===s.total){for(r=0,t=(o=c.promises.success).length;r<t;r++)(0,o[r])();for(e=0,n=(i=c.promises.then).length;e<n;e++)(0,i[e])()}return s.success},validatedError:function(){var r,e,t,n,o,i;if(0==s.error++){for(r=0,t=(o=c.promises.error).length;r<t;r++)(0,o[r])();for(e=0,n=(i=c.promises.then).length;e<n;e++)(0,i[e])()}return s.error}},l.success=function(r){return c.promises.success.push(r),l},l.error=function(r){return c.promises.error.push(r),l},l.then=function(r){return c.promises.then.push(r),l},a={model:i,accept:c.accept,success:c.validatedSuccess,error:c.validatedError},o.$broadcast(r.broadcastChannel.prepare,a),n(function(){var r,t,n,i;if(0!==s.total)return r=e.get("$validator"),o.$broadcast(r.broadcastChannel.start,a);for(t=0,n=(i=c.promises.success).length;t<n;t++)(0,i[t])()}),l}}(this),this.reset=function(r){return function(e,t){return e.$broadcast(r.broadcastChannel.reset,{model:t})}}(this),this.get=function(r){return this.setupProviders(r),{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this);