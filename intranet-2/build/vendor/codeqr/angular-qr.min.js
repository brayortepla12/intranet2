!function(t){"use strict";angular.module("ja.qr",[]).controller("QrCtrl",["$scope",function(t){t.getTypeNumeber=function(){return t.typeNumber||0},t.getCorrection=function(){return{L:1,M:0,Q:3,H:2}[t.correctionLevel||0]||0},t.getText=function(){return t.text||""},t.getSize=function(){return t.size||250},t.isNUMBER=function(t){return/^[0-9]*$/.test(t)},t.isALPHA_NUM=function(t){return/^[0-9A-Z $%*+\-./:]*$/.test(t)},t.is8bit=function(t){for(var e=0;e<t.length;e++){if(t.charCodeAt(e)>255)return!1}return!0},t.checkInputMode=function(e,n){if("NUMBER"===e&&!t.isNUMBER(n))throw new Error("The `NUMBER` input mode is invalid for text.");if("ALPHA_NUM"===e&&!t.isALPHA_NUM(n))throw new Error("The `ALPHA_NUM` input mode is invalid for text.");if("8bit"===e&&!t.is8bit(n))throw new Error("The `8bit` input mode is invalid for text.");if(!t.is8bit(n))throw new Error("Input mode is invalid for text.");return!0},t.getInputMode=function(e){var n=t.inputMode;return n=(n=(n=n||(t.isNUMBER(e)?"NUMBER":void 0))||(t.isALPHA_NUM(e)?"ALPHA_NUM":void 0))||(t.is8bit(e)?"8bit":""),t.checkInputMode(n,e)?n:""}}]).directive("qr",["$timeout","$window",function(e,n){return{restrict:"E",template:'<canvas ng-hide="image"></canvas><img ng-if="image" ng-src="{{canvasImage}}"/>',scope:{typeNumber:"=",correctionLevel:"=",inputMode:"=",size:"=",text:"=",image:"="},controller:"QrCtrl",link:function(i,r,o){if(void 0===i.text)throw new Error("The `text` attribute is required.");var E=r.find("canvas")[0],u=!!n.CanvasRenderingContext2D;i.TYPE_NUMBER=i.getTypeNumeber(),i.TEXT=i.getText(),i.CORRECTION=i.getCorrection(),i.SIZE=i.getSize(),i.INPUT_MODE=i.getInputMode(i.TEXT),i.canvasImage="";var a=function(e,n,r,o,E,a){var c=n.replace(/^\s+|\s+$/g,""),T=new t(r,o,a);T.addData(c),T.make();var M=e.getContext("2d"),f=T.getModuleCount(),N=E/f;e.width=e.height=E,u&&(!function(t,e,n,i){for(var r=0;r<n;r++)for(var o=0;o<n;o++){var E=Math.ceil((o+1)*i)-Math.floor(o*i),u=Math.ceil((r+1)*i)-Math.floor(r*i);t.fillStyle=e.isDark(r,o)?"#000":"#fff",t.fillRect(Math.round(o*i),Math.round(r*i),E,u)}}(M,T,f,N),i.canvasImage=e.toDataURL()||"")};a(E,i.TEXT,i.TYPE_NUMBER,i.CORRECTION,i.SIZE,i.INPUT_MODE),e(function(){i.$watch("text",function(t,e){t!==e&&(i.TEXT=i.getText(),i.INPUT_MODE=i.getInputMode(i.TEXT),a(E,i.TEXT,i.TYPE_NUMBER,i.CORRECTION,i.SIZE,i.INPUT_MODE))}),i.$watch("correctionLevel",function(t,e){t!==e&&(i.CORRECTION=i.getCorrection(),a(E,i.TEXT,i.TYPE_NUMBER,i.CORRECTION,i.SIZE,i.INPUT_MODE))}),i.$watch("typeNumber",function(t,e){t!==e&&(i.TYPE_NUMBER=i.getTypeNumeber(),a(E,i.TEXT,i.TYPE_NUMBER,i.CORRECTION,i.SIZE,i.INPUT_MODE))}),i.$watch("size",function(t,e){t!==e&&(i.SIZE=i.getSize(),a(E,i.TEXT,i.TYPE_NUMBER,i.CORRECTION,i.SIZE,i.INPUT_MODE))}),i.$watch("inputMode",function(t,e){t!==e&&(i.INPUT_MODE=i.getInputMode(i.TEXT),a(E,i.TEXT,i.TYPE_NUMBER,i.CORRECTION,i.SIZE,i.INPUT_MODE))})})}}}])}(window.QRCode);