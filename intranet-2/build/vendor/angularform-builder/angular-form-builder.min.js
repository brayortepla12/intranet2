(function(){var e;e=function(e,t){var o,r;for(o in e)r=e[o],"$$hashKey"!==o&&(t[o]=r)},angular.module("builder.controller",["builder.provider"]).controller("fbFormObjectEditableController",["$scope","$injector",function(t,o){var r;return r=o.get("$builder"),t.setupScope=function(o){var n;return e(o,t),t.optionsText=o.options.join("\n"),t.$watch("[label, description, placeholder, required, options, validation]",function(){return o.label=t.label,o.description=t.description,o.placeholder=t.placeholder,o.required=t.required,o.options=t.options,o.validation=t.validation},!0),t.$watch("optionsText",function(e){var o;return t.options=function(){var t,r,n,i;for(i=[],t=0,r=(n=e.split("\n")).length;t<r;t++)(o=n[t]).length>0&&i.push(o);return i}(),t.inputText=t.options[0]}),n=r.components[o.component],t.validationOptions=n.validationOptions},t.data={model:null,backup:function(){return this.model={label:t.label,description:t.description,placeholder:t.placeholder,required:t.required,optionsText:t.optionsText,validation:t.validation}},rollback:function(){if(this.model)return t.label=this.model.label,t.description=this.model.description,t.placeholder=this.model.placeholder,t.required=this.model.required,t.optionsText=this.model.optionsText,t.validation=this.model.validation}}}]).controller("fbComponentsController",["$scope","$injector",function(e,t){var o;return o=t.get("$builder"),e.selectGroup=function(t,r){var n,i,l,u;for(i in null!=t&&t.preventDefault(),e.activeGroup=r,e.components=[],u=[],l=o.components)(n=l[i]).group===r&&u.push(e.components.push(n));return u},e.groups=o.groups,e.activeGroup=e.groups[0],e.allComponents=o.components,e.$watch("allComponents",function(){return e.selectGroup(null,e.activeGroup)})}]).controller("fbComponentController",["$scope",function(t){return t.copyObjectToScope=function(o){return e(o,t)}}]).controller("fbFormController",["$scope","$injector",function(e,t){var o,r;return o=t.get("$builder"),r=t.get("$timeout"),null==e.input&&(e.input=[]),e.$watch("form",function(){return e.input.length>e.form.length&&e.input.splice(e.form.length),r(function(){return e.$broadcast(o.broadcastChannel.updateInput)})},!0)}]).controller("fbFormObjectController",["$scope","$injector",function(t,o){return o.get("$builder"),t.copyObjectToScope=function(o){return e(o,t)},t.updateInput=function(e){var o;return o={id:t.formObject.id,label:t.formObject.label,value:null!=e?e:""},t.$parent.input.splice(t.$index,1,o)}}])}).call(this),function(){angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]).directive("fbBuilder",["$injector",function(e){var t,o;return t=e.get("$builder"),o=e.get("$drag"),{restrict:"A",scope:{fbBuilder:"="},template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects track by $index\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(e,r,n){var i,l,u;return e.formName=n.fbBuilder,null==(l=t.forms)[u=e.formName]&&(l[u]=[]),e.formObjects=t.forms[e.formName],i=!0,$(r).addClass("fb-builder"),o.droppable($(r),{move:function(e){var t,o,n,l,u,a,c,p,s,d,f;if(i&&($("div.fb-form-object-editable").popover("hide"),i=!1),0!==(n=$(r).find(".fb-form-object-editable:not(.empty,.dragging)")).length){for((c=[]).push(-1e3),u=p=0,d=n.length;p<d;u=p+=1)a=(o=$(n[u])).offset(),l=o.height(),c.push(a.top+l/2);for(c.push(c[c.length-1]+1e3),u=s=1,f=c.length;s<f;u=s+=1)if(e.pageY>c[u-1]&&e.pageY<=c[u]){$(r).find(".empty").remove(),t=$("<div class='fb-form-object-editable empty'></div>"),u-1<n.length?t.insertBefore($(n[u-1])):t.insertAfter($(n[u-2]));break}}else 0===$(r).find(".fb-form-object-editable.empty").length&&$(r).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"))},out:function(){return i&&($("div.fb-form-object-editable").popover("hide"),i=!1),$(r).find(".empty").remove()},up:function(l,u,a){var c,p,s;if(i=!0,o.isMouseMoved())return u||"drag"!==a.mode?u&&("mirror"===a.mode&&t.insertFormObject(e.formName,$(r).find(".empty").index(".fb-form-object-editable"),{component:a.object.componentName}),"drag"===a.mode&&((s=a.object.formObject.index)<(p=$(r).find(".empty").index(".fb-form-object-editable"))&&p--,t.updateFormObjectIndex(e.formName,s,p))):(c=a.object.formObject).editable&&t.removeFormObject(n.fbBuilder,c.index),$(r).find(".empty").remove();$(r).find(".empty").remove()}})}}}]).directive("fbFormObjectEditable",["$injector",function(e){var t,o,r,n;return t=e.get("$builder"),r=e.get("$drag"),o=e.get("$compile"),n=e.get("$validator"),{restrict:"A",controller:"fbFormObjectEditableController",scope:{formObject:"=fbFormObjectEditable"},link:function(e,i){var l;if(e.inputArray=[],e.$component=t.components[e.formObject.component],e.setupScope(e.formObject),e.$watch("$component.template",function(t){var r;if(t)return r=o(t)(e),$(i).html(r)}),$(i).on("click",function(){return!1}),r.draggable($(i),{object:{formObject:e.formObject}}),e.formObject.editable)return l={},e.$watch("$component.popoverTemplate",function(r){if(r)return $(i).removeClass(l.id),(l={id:"fb-"+Math.random().toString().substr(2),isClickedSave:!1,view:null,html:r}).html=$(l.html).addClass(l.id),l.view=o(l.html)(e),$(i).addClass(l.id),$(i).popover({html:!0,title:e.$component.label,content:l.view,container:"body",placement:t.config.popoverPlacement})}),e.popover={save:function(t){t.preventDefault(),n.validate(e).success(function(){return l.isClickedSave=!0,$(i).popover("hide")})},remove:function(o){o.preventDefault(),t.removeFormObject(e.$parent.formName,e.$parent.$index),$(i).popover("hide")},shown:function(){return e.data.backup(),l.isClickedSave=!1},cancel:function(t){e.data.rollback(),t&&(t.preventDefault(),$(i).popover("hide"))}},$(i).on("show.bs.popover",function(){var e,t;return!r.isMouseMoved()&&($("div.fb-form-object-editable:not(."+l.id+")").popover("hide"),(e=$("form."+l.id).closest(".popover")).length>0?(t=$(i).offset().top+$(i).height()/2-e.height()/2,e.css({position:"absolute",top:t}),e.show(),setTimeout(function(){return e.addClass("in"),$(i).triggerHandler("shown.bs.popover")},0),!1):void 0)}),$(i).on("shown.bs.popover",function(){$(".popover ."+l.id+" input:first").select(),e.$apply(function(){return e.popover.shown()})}),$(i).on("hide.bs.popover",function(){var t;return t=$("form."+l.id).closest(".popover"),l.isClickedSave||(e.$$phase||e.$root.$$phase?e.popover.cancel():e.$apply(function(){return e.popover.cancel()})),t.removeClass("in"),setTimeout(function(){return t.hide()},300),!1})}}}]).directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',controller:"fbComponentsController"}}).directive("fbComponent",["$injector",function(e){var t,o;return e.get("$builder"),o=e.get("$drag"),t=e.get("$compile"),{restrict:"A",scope:{component:"=fbComponent"},controller:"fbComponentController",link:function(e,r){return e.copyObjectToScope(e.component),o.draggable($(r),{mode:"mirror",defer:!1,object:{componentName:e.component.name}}),e.$watch("component.template",function(o){var n;if(o)return n=t(o)(e),$(r).html(n)})}}}]).directive("fbForm",["$injector",function(e){return{restrict:"A",require:"ngModel",scope:{formName:"@fbForm",input:"=ngModel",default:"=fbDefault"},template:'<div class=\'fb-form-object\' ng-repeat="object in form track by $index" fb-form-object="object"></div>',controller:"fbFormController",link:function(t,o,r){var n,i,l;return null==(i=(n=e.get("$builder")).forms)[l=t.formName]&&(i[l]=[]),t.form=n.forms[t.formName]}}}]).directive("fbFormObject",["$injector",function(e){var t,o,r;return t=e.get("$builder"),o=e.get("$compile"),r=e.get("$parse"),{restrict:"A",controller:"fbFormObjectController",link:function(e,n,i){return e.formObject=r(i.fbFormObject)(e),e.$component=t.components[e.formObject.component],e.$on(t.broadcastChannel.updateInput,function(){return e.updateInput(e.inputText)}),e.$component.arrayToText&&(e.inputArray=[],e.$watch("inputArray",function(t,o){var r,n,i;if(t!==o){for(n in r=[],e.inputArray)e.inputArray[n]&&r.push(null!=(i=e.options[n])?i:e.inputArray[n]);return e.inputText=r.join(", ")}},!0)),e.$watch("inputText",function(){return e.updateInput(e.inputText)}),e.$watch(i.fbFormObject,function(){return e.copyObjectToScope(e.formObject)},!0),e.$watch("$component.template",function(t){var r,i;if(t)return(r=$(t)).find("[ng-model='inputText']").attr({validator:"{{validation}}"}),i=o(r)(e),$(n).html(i)}),!e.$component.arrayToText&&e.formObject.options.length>0&&(e.inputText=e.formObject.options[0]),e.$watch("default['"+e.formObject.id+"']",function(t){if(t)return e.$component.arrayToText?e.inputArray=t:e.inputText=t})}}}])}.call(this),function(){angular.module("builder.drag",[]).provider("$drag",function(){var e,t,o;e=null,this.data={draggables:{},droppables:{}},this.mouseMoved=!1,this.isMouseMoved=(o=this,function(){return o.mouseMoved}),this.hooks={down:{},move:{},up:{}},this.eventMouseMove=function(){},this.eventMouseUp=function(){},$(function(e){return function(){return $(document).on("mousedown",function(t){var o,r;for(o in e.mouseMoved=!1,r=e.hooks.down)(0,r[o])(t)}),$(document).on("mousemove",function(t){var o,r;for(o in e.mouseMoved=!0,r=e.hooks.move)(0,r[o])(t)}),$(document).on("mouseup",function(t){var o,r;for(o in r=e.hooks.up)(0,r[o])(t)})}}(this)),this.currentId=0,this.getNewId=function(e){return function(){return""+e.currentId++}}(this),this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(e,t,o,r,n){return-r*(t/=n)*(t-2)+o}})},this.setupProviders=function(t){return e=t.get("$rootScope")},this.isHover=function(e,t){var o,r,n,i,l;return r=e.offset(),n=t.offset(),i={width:e.width(),height:e.height()},l={width:t.width(),height:t.height()},(o={x:!1,y:!1}).x=r.left>n.left&&r.left<n.left+l.width,o.x=o.x||r.left+i.width>n.left&&r.left+i.width<n.left+l.width,!!o&&(o.y=r.top>n.top&&r.top<n.top+l.height,o.y=o.y||r.top+i.height>n.top&&r.top+i.height<n.top+l.height,o.x&&o.y)},t=function(e,t){return setTimeout(function(){return t()},e)},this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(e){return function(){return e.autoScroll.scrolling=!0,e.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),t(100,function(){return e.autoScroll.scroll()})):e.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),t(100,function(){return e.autoScroll.scroll()})):e.autoScroll.scrolling=!1}}(this),start:function(e){return function(t){if(t.clientY<50){if(e.autoScroll.up=!0,e.autoScroll.down=!1,!e.autoScroll.scrolling)return e.autoScroll.scroll()}else{if(!(t.clientY>$(window).innerHeight()-50))return e.autoScroll.up=!1,e.autoScroll.down=!1;if(e.autoScroll.up=!1,e.autoScroll.down=!0,!e.autoScroll.scrolling)return e.autoScroll.scroll()}}}(this),stop:function(e){return function(){return e.autoScroll.up=!1,e.autoScroll.down=!1}}(this)},this.dragMirrorMode=function(e){return function(t,o,r){var n;return null==o&&(o=!0),n={id:e.getNewId(),mode:"mirror",maternal:t[0],element:null,object:r},t.on("mousedown",function(r){var i;if(r.preventDefault(),i=t.clone(),n.element=i[0],i.addClass("fb-draggable form-horizontal prepare-dragging"),e.hooks.move.drag=function(o,r){var l,u,a,c;if(!i.hasClass("prepare-dragging")||(i.css({width:t.width(),height:t.height()}),i.removeClass("prepare-dragging"),i.addClass("dragging"),!r)){for(u in i.offset({left:o.pageX-i.width()/2,top:o.pageY-i.height()/2}),e.autoScroll.start(o),c=[],a=e.data.droppables)l=a[u],e.isHover(i,$(l.element))?c.push(l.move(o,n)):c.push(l.out(o,n));return c}},e.hooks.up.drag=function(t){var o,r,l,u;for(r in u=e.data.droppables)o=u[r],l=e.isHover(i,$(o.element)),o.up(t,l,n);return delete e.hooks.move.drag,delete e.hooks.up.drag,n.element=null,i.remove(),e.autoScroll.stop()},$("body").append(i),!o)return e.hooks.move.drag(r,o)}),n}}(this),this.dragDragMode=function(e){return function(t,o,r){var n;return null==o&&(o=!0),n={id:e.getNewId(),mode:"drag",maternal:null,element:t[0],object:r},t.addClass("fb-draggable"),t.on("mousedown",function(r){if(r.preventDefault(),!t.hasClass("dragging"))return t.addClass("prepare-dragging"),e.hooks.move.drag=function(o,r){var i,l,u;if(!t.hasClass("prepare-dragging")||(t.css({width:t.width(),height:t.height()}),t.removeClass("prepare-dragging"),t.addClass("dragging"),!r))for(l in t.offset({left:o.pageX-t.width()/2,top:o.pageY-t.height()/2}),e.autoScroll.start(o),u=e.data.droppables)i=u[l],e.isHover(t,$(i.element))?i.move(o,n):i.out(o,n)},e.hooks.up.drag=function(o){var r,i,l,u;for(i in u=e.data.droppables)r=u[i],l=e.isHover(t,$(r.element)),r.up(o,l,n);return delete e.hooks.move.drag,delete e.hooks.up.drag,t.css({width:"",height:"",left:"",top:""}),t.removeClass("dragging defer-dragging"),e.autoScroll.stop()},o?void 0:e.hooks.move.drag(r,o)}),n}}(this),this.dropMode=function(t){return function(o,r){return{id:t.getNewId(),element:o[0],move:function(t,o){return e.$apply(function(){return"function"==typeof r.move?r.move(t,o):void 0})},up:function(t,o,n){return e.$apply(function(){return"function"==typeof r.up?r.up(t,o,n):void 0})},out:function(t,o){return e.$apply(function(){return"function"==typeof r.out?r.out(t,o):void 0})}}}}(this),this.draggable=function(e){return function(t,o){var r,n,i,l,u,a,c;if(null==o&&(o={}),i=[],"mirror"===o.mode)for(l=0,a=t.length;l<a;l++)n=t[l],r=e.dragMirrorMode($(n),o.defer,o.object),i.push(r.id),e.data.draggables[r.id]=r;else for(u=0,c=t.length;u<c;u++)n=t[u],r=e.dragDragMode($(n),o.defer,o.object),i.push(r.id),e.data.draggables[r.id]=r;return i}}(this),this.droppable=function(e){return function(t,o){var r,n,i,l,u;for(null==o&&(o={}),i=[],l=0,u=t.length;l<u;l++)n=t[l],r=e.dropMode($(n),o),i.push(r),e.data.droppables[r.id]=r;return i}}(this),this.get=function(e){return this.setupEasing(),this.setupProviders(e),{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this),function(){angular.module("builder",["builder.directive"])}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var t,o,r,n;o=null,t=null,r=null,this.config={popoverPlacement:"right"},this.components={},this.groups=[],this.broadcastChannel={updateInput:"$updateInput"},this.forms={default:[]},this.convertComponent=function(e,t){var o,r,n,i,l,u,a,c,p,s,d;return(o={name:e,group:null!=(r=t.group)?r:"Default",label:null!=(n=t.label)?n:"",description:null!=(i=t.description)?i:"",placeholder:null!=(l=t.placeholder)?l:"",editable:null==(u=t.editable)||u,required:null!=(a=t.required)&&a,validation:null!=(c=t.validation)?c:"/.*/",validationOptions:null!=(p=t.validationOptions)?p:[],options:null!=(s=t.options)?s:[],arrayToText:null!=(d=t.arrayToText)&&d,template:t.template,templateUrl:t.templateUrl,popoverTemplate:t.popoverTemplate,popoverTemplateUrl:t.popoverTemplateUrl}).template||o.templateUrl||console.error("The template is empty."),o.popoverTemplate||o.popoverTemplateUrl||console.error("The popoverTemplate is empty."),o},this.convertFormObject=function(e,t){var o,r,n,i,l,u,a,c,p;if(null==t&&(t={}),null==(o=this.components[t.component]))throw"The component "+t.component+" was not registered.";return{id:t.id,component:t.component,editable:null!=(r=t.editable)?r:o.editable,index:null!=(n=t.index)?n:0,label:null!=(i=t.label)?i:o.label,description:null!=(l=t.description)?l:o.description,placeholder:null!=(u=t.placeholder)?u:o.placeholder,options:null!=(a=t.options)?a:o.options,required:null!=(c=t.required)?c:o.required,validation:null!=(p=t.validation)?p:o.validation}},this.reindexFormObject=(n=this,function(e){var t,o,r,i;for(o=r=0,i=(t=n.forms[e]).length;r<i;o=r+=1)t[o].index=o}),this.setupProviders=function(e){return t=(o=e).get("$http"),r=o.get("$templateCache")},this.loadTemplate=function(e){if(null==e.template&&t.get(e.templateUrl,{cache:r}).success(function(t){return e.template=t}),null==e.popoverTemplate)return t.get(e.popoverTemplateUrl,{cache:r}).success(function(t){return e.popoverTemplate=t})},this.registerComponent=function(t){return function(r,n){var i,l;null==n&&(n={}),null==t.components[r]?(i=t.convertComponent(r,n),t.components[r]=i,null!=o&&t.loadTemplate(i),l=i.group,e.call(t.groups,l)<0&&t.groups.push(i.group)):console.error("The component "+r+" was registered.")}}(this),this.addFormObject=function(e){return function(t,o){var r;return null==o&&(o={}),null==(r=e.forms)[t]&&(r[t]=[]),e.insertFormObject(t,e.forms[t].length,o)}}(this),this.insertFormObject=function(e){return function(t,o,r){var n;return null==r&&(r={}),null==(n=e.forms)[t]&&(n[t]=[]),o>e.forms[t].length?o=e.forms[t].length:o<0&&(o=0),e.forms[t].splice(o,0,e.convertFormObject(t,r)),e.reindexFormObject(t),e.forms[t][o]}}(this),this.removeFormObject=function(e){return function(t,o){return e.forms[t].splice(o,1),e.reindexFormObject(t)}}(this),this.updateFormObjectIndex=function(e){return function(t,o,r){var n,i;if(o!==r)return n=(i=e.forms[t]).splice(o,1)[0],i.splice(r,0,n),e.reindexFormObject(t)}}(this),this.$get=["$injector",function(e){return function(t){var o,r,n;for(r in e.setupProviders(t),n=e.components)o=n[r],e.loadTemplate(o);return{config:e.config,components:e.components,groups:e.groups,forms:e.forms,broadcastChannel:e.broadcastChannel,registerComponent:e.registerComponent,addFormObject:e.addFormObject,insertFormObject:e.insertFormObject,removeFormObject:e.removeFormObject,updateFormObjectIndex:e.updateFormObjectIndex}}}(this)]})}.call(this);