!function(e,t){((function(){return this})()).true=e;var n={};angular.module("textAngularSetup",[]).constant("taRegisterTool",function(e,t){if(!e||""===e||n.hasOwnProperty(e))throw"textAngular Error: A unique name is required for a Tool Definition";if(t.display&&(""===t.display||!function(e){try{return 0!==angular.element(e).length}catch(e){return!1}}(t.display))||!t.display&&!t.buttontext&&!t.iconclass)throw'textAngular Error: Tool Definition for "'+e+'" does not have a valid display/iconclass/buttontext value';n[e]=t}).value("taTools",n).value("taOptions",{forceTextAngularSanitize:!0,keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)&&(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0)}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(e,t){return{imgOnSelectAction:function(e,t,n){var a=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var o=n.displayElements.popoverContainer;o.empty();var r=angular.element('<div class="btn-group" style="padding-right: 6px;">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');d.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),r.append(l),r.append(i),r.append(s),r.append(d),o.append(r),r=angular.element('<div class="btn-group" style="padding-right: 6px;">');var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');c.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),r.append(u),r.append(p),r.append(c),o.append(r),r=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(e){e.preventDefault(),t.remove(),a()}),r.append(f),o.append(r),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(n,a,o){n.preventDefault(),o.displayElements.popover.css("width","436px");var r=o.displayElements.popoverContainer;r.empty(),r.css("line-height","28px");var l=angular.element('<a href="'+a.attr("href")+'" target="_blank">'+a.attr("href")+"</a>");l.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),r.append(l);var i=angular.element('<div class="btn-group pull-right">'),s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');s.on("click",function(n){n.preventDefault();var r=e.prompt(t.insertLink.dialogPrompt,a.attr("href"));r&&""!==r&&"http://"!==r&&(a.attr("href",r),o.updateTaBindtaTextElement()),o.hidePopover()}),i.append(s);var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');d.on("click",function(e){e.preventDefault(),a.replaceWith(a.contents()),o.updateTaBindtaTextElement(),o.hidePopover()}),i.append(d);var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+t.editLink.targetToggle.buttontext+"</button>");"_blank"===a.attr("target")&&u.addClass("active"),u.on("click",function(e){e.preventDefault(),a.attr("target","_blank"===a.attr("target")?"":"_blank"),u.toggleClass("active"),o.updateTaBindtaTextElement()}),i.append(u),r.append(i),o.showPopover(a)},extractYoutubeVideoId:function(e){var t=e.match(/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);return t&&t[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions",function(e,t,n,a,o,r,l){var i={};if(r("",i),!0===l.forceTextAngularSanitize&&"taSanitize"!==i.version)throw angular.$$minErr("textAngular")("textAngularSetup","The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var s=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:s,activeState:function(e){return function(){return this.$editor().queryFormatBlockState(e)}}(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="right"===e.css("text-align")),t||this.$editor().queryCommandState("justifyRight")}}),e("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:n.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(e){var t=!1;return e&&(t="justify"===e.css("text-align")),t||this.$editor().queryCommandState("justifyFull")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="center"===e.css("text-align")),t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:n.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var o=angular.element(a.getSelectionElement()),r=function(e){var t=e=angular.element(e);angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(o.find("ul"),r),angular.forEach(o.find("ol"),r),"li"===o[0].tagName.toLowerCase()){var l=o[0].parentNode.childNodes,i=[],s=[],d=!1;for(n=0;n<l.length;n++)l[n]===o[0]?d=!0:d?s.push(l[n]):i.push(l[n]);var u=angular.element(o[0].parentNode),c=angular.element("<p></p>");if(c.html(angular.element(o[0]).html()),0===i.length||0===s.length)0===s.length?u.after(c):u[0].parentNode.insertBefore(c[0],u[0]),0===i.length&&0===s.length?u.remove():angular.element(o[0]).remove();else{var p=angular.element("<"+u[0].tagName+"></"+u[0].tagName+">"),f=angular.element("<"+u[0].tagName+"></"+u[0].tagName+">");for(n=0;n<i.length;n++)p.append(angular.element(i[n]));for(n=0;n<s.length;n++)f.append(angular.element(s[n]));u.after(f),u.after(c),u.after(p),u.remove()}a.setSelectionToElementEnd(c[0])}var m=this.$editor(),g=function(e){(e=angular.element(e))[0]!==m.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),g)};angular.forEach(o,g),"li"!==o[0].tagName.toLowerCase()&&"ol"!==o[0].tagName.toLowerCase()&&"ul"!==o[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}}),e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;return(e=t.prompt(n.insertImage.dialogPrompt,"http://"))&&""!==e&&"http://"!==e?this.$editor().wrapSelection("insertImage",e,!0):void 0},onElementSelect:{element:"img",action:o.imgOnSelectAction}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if((e=t.prompt(n.insertVideo.dialogPrompt,"https://"))&&""!==e&&"https://"!==e&&(videoId=o.extractYoutubeVideoId(e),videoId)){var a="https://www.youtube.com/embed/"+videoId,r='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+a+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",r,!0)}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:o.imgOnSelectAction}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return(e=t.prompt(n.insertLink.dialogPrompt,"http://"))&&""!==e&&"http://"!==e?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return!!e&&"A"===e[0].tagName},onElementSelect:{element:"a",action:o.aOnSelectAction}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text[0].innerHTML||"",t=0;return""!==e.replace(/\s*<[^>]*?>\s*/g,"")&&(t=e.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=t,this.$editor().wordcount=t,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=(e[0].innerText||e[0].textContent).replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=t,this.$editor().charcount=t,!1}})}]),"undefined"!=typeof module&&void 0!==e&&module.exports===e&&(module.exports="textAngular"),function(){"use strict";var t=function(){for(var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return e>4?e:void 0}(),a=/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent),o=!1;a&&(document.addEventListener("mousedown",function(e){var t=(e||window.event).target;if(o&&null!==t){for(var n=!1,a=t;null!==a&&"html"!==a.tagName.toLowerCase()&&!n;)n="true"===a.contentEditable,a=a.parentNode;n||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),t.focus(),t.select&&t.select())}o=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" aria-hidden="true" unselectable="on" tabIndex="-1">'))}));var r,l,i,s,d,u,c=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,p=/^(ul|li|ol)$/i,f=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),t>8||void 0===t){for(var m=document.styleSheets,g=0;g<m.length;g++)if((0===m[g].media.length||m[g].media.mediaText.match(/(all|screen)/gi))&&m[g].href&&m[g].href.match(/textangular\.(min\.|)css/gi)){r=m[g];break}r||(r=function(){var e=document.createElement("style");return a&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),l=function(e,t){return s(r,e,t)},s=function(e,t,n){var a,o;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),r.rules?o=r.rules[a]:r.cssRules&&(o=r.cssRules[a]),o},u=function(e,t){var n,a;for(n=0;n<t.length;n++)if(t[n].cssText===e.cssText){a=n;break}return a},i=function(e){d(r,e)},d=function(e,t){var n=e.cssRules||e.rules;if(n&&0!==n.length){var a=u(t,n);e.removeRule?e.removeRule(a):e.deleteRule(a)}}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===t?"div":t<=8?"P":"p":t<=8?e.toUpperCase():e:t<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var a=angular.element("<div></div>");return a[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=a.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(a,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),a[0].innerHTML}}]).factory("taFixChrome",function(){return function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,a,o=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,r="",l=0;t=o.exec(e);)(n=t[3]||t[4])&&n.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/gi,""),a="<"+t[1].trim(),n.trim().length>0&&(a+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),a+=t[5].trim()+">",r+=e.substring(l,t.index)+a,l=t.index+t[0].length);return r+=e.substring(l),l>0?r.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e}}).factory("taSanitize",["$sanitize",function(e){function t(e,t){for(var n,a=0,o=0,r=/<[^>]*>/gi;n=r.exec(e);)if(o=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,o)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(o)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var o,r,l,i,d,u,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,p="",f="",m=0;r=c.exec(e);){i=r[3]||r[4];var g=new RegExp(s,"i");if(angular.isString(i)&&g.test(i)){d="";for(var h=new RegExp(s,"ig");l=h.exec(i);)for(o=0;o<a.length;o++)l[2*o+2]&&(d+="<"+a[o].tag+">");u=n(e.substring(m,r.index)),f+=p.length>0?t(u,p):u,i=i.replace(new RegExp(s,"ig"),""),f+="<"+r[1].trim(),i.length>0&&(f+=' style="'+i+'"'),f+=r[5]+">",m=r.index+r[0].length,p=d}}return f+(p.length>0?t(e.substring(m),p):e.substring(m))}for(var a=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],o=[],r=0;r<a.length;r++){for(var l="("+a[r].property+":\\s*(",i=0;i<a[r].values.length;i++)i>0&&(l+="|"),l+=a[r].values[i];l+=");)",o.push(l)}var s="("+o.join("|")+")";return function(t,a,o){if(!o)try{t=n(t)}catch(e){}var r;t=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",o=0;t=n.exec(e);){a+=e.substring(o,t.index),o=t.index+t[0].length;var r="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(r)?r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):r+=' style="text-align:'+(t[3]||t[4])+';"',a+=r+=">"}return a+e.substring(o)}(t);try{r=e(t),o&&(r=t)}catch(e){r=a||""}var l,i=r.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),s=r.replace(/(&#(9|10);)*/gi,""),d=/<pre[^>]*>.*?<\/pre[^>]*>/gi,u=0,c=0;for(r="";null!==(l=d.exec(s))&&u<i.length;)r+=s.substring(c,l.index)+i[u],c=l.index+l[0].length,u++;return r+s.substring(c)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var a,o=e.defer(),r=o.promise,l=this.$editor();try{a=this.action(o,l.startAction()),r.finally(function(){l.endAction.call(l)})}catch(e){t.error(e)}(a||void 0===a)&&o.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var a=function(t,n){var a,o,r=t.find("li");for(o=r.length-1;o>=0;o--)a=angular.element("<"+n+">"+r[o].innerHTML+"</"+n+">"),t.after(a);t.remove(),e.setSelectionToElementEnd(a[0])},o=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},r=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),o(n.find("li")[0])},l=function(e,n,a){for(var r="",l=0;l<e.length;l++)r+="<"+t("li")+">"+e[l].innerHTML+"</"+t("li")+">";var i=angular.element("<"+a+">"+r+"</"+a+">");n.after(i),n.remove(),o(i.find("li")[0])};return function(o,i){return o=t(o),function(s,d,u,f){var m,g,h,v,y,b,x,E=angular.element("<"+o+">");try{x=e.getSelectionElement()}catch(e){}var w=angular.element(x);if(void 0!==x){var S=x.tagName.toLowerCase();if("insertorderedlist"===s.toLowerCase()||"insertunorderedlist"===s.toLowerCase()){var T=t("insertorderedlist"===s.toLowerCase()?"ol":"ul");if(S===T)return a(w,o);if("li"===S&&w.parent()[0].tagName.toLowerCase()===T&&1===w.parent().children().length)return a(w.parent(),o);if("li"===S&&w.parent()[0].tagName.toLowerCase()!==T&&1===w.parent().children().length)return r(w.parent(),T);if(S.match(c)&&!w.hasClass("ta-bind")){if("ol"===S||"ul"===S)return r(w,T);var C=!1;return angular.forEach(w.children(),function(e){e.tagName.match(c)&&(C=!0)}),l(C?w.children():[angular.element("<div>"+x.innerHTML+"</div>")[0]],w,T)}if(S.match(c)){if(0===(v=e.getOnlySelectedElements()).length)g=angular.element("<"+T+"><li>"+x.innerHTML+"</li></"+T+">"),w.html(""),w.append(g);else{if(1===v.length&&("ol"===v[0].tagName.toLowerCase()||"ul"===v[0].tagName.toLowerCase()))return v[0].tagName.toLowerCase()===T?a(angular.element(v[0]),o):r(angular.element(v[0]),T);h="";var $=[];for(m=0;m<v.length;m++)if(3!==v[m].nodeType){var N=angular.element(v[m]);if("li"===v[m].tagName.toLowerCase())continue;h+="ol"===v[m].tagName.toLowerCase()||"ul"===v[m].tagName.toLowerCase()?N[0].innerHTML:"span"!==v[m].tagName.toLowerCase()||"ol"!==v[m].childNodes[0].tagName.toLowerCase()&&"ul"!==v[m].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+N[0].innerHTML+"</"+t("li")+">":N[0].childNodes[0].innerHTML,$.unshift(N)}g=angular.element("<"+T+">"+h+"</"+T+">"),$.pop().replaceWith(g),angular.forEach($,function(e){e.remove()})}return void e.setSelectionToElementEnd(g[0])}}else{if("formatblock"===s.toLowerCase()){for("default"===(b=u.toLowerCase().replace(/[<>]/gi,"")).trim()&&(b=o,u="<"+o+">"),g="li"===S?w.parent():w;!g[0].tagName||!g[0].tagName.match(c)&&!g.parent().attr("contenteditable");)S=((g=g.parent())[0].tagName||"").toLowerCase();if(S===b){v=g.children();var L=!1;for(m=0;m<v.length;m++)L=L||v[m].tagName.match(c);L?(g.after(v),y=g.next(),g.remove(),g=y):(E.append(g[0].childNodes),g.after(E),g.remove(),g=E)}else if(g.parent()[0].tagName.toLowerCase()!==b||g.parent().hasClass("ta-bind"))if(S.match(p))g.wrap(u);else{for(0===(v=e.getOnlySelectedElements()).length&&(v=[g[0]]),m=0;m<v.length;m++)if(3===v[m].nodeType||!v[m].tagName.match(c))for(;3===v[m].nodeType||!v[m].tagName||!v[m].tagName.match(c);)v[m]=v[m].parentNode;if(angular.element(v[0]).hasClass("ta-bind"))(g=angular.element(u))[0].innerHTML=v[0].innerHTML,v[0].innerHTML=g[0].outerHTML;else if("blockquote"===b){for(h="",m=0;m<v.length;m++)h+=v[m].outerHTML;for((g=angular.element(u))[0].innerHTML=h,v[0].parentNode.insertBefore(g[0],v[0]),m=v.length-1;m>=0;m--)v[m].parentNode&&v[m].parentNode.removeChild(v[m])}else for(m=0;m<v.length;m++)(g=angular.element(u))[0].innerHTML=v[m].innerHTML,v[m].parentNode.insertBefore(g[0],v[m]),v[m].parentNode.removeChild(v[m])}else{var k=g.parent(),A=k.contents();for(m=0;m<A.length;m++)k.parent().hasClass("ta-bind")&&3===A[m].nodeType&&((E=angular.element("<"+o+">"))[0].innerHTML=A[m].outerHTML,A[m]=E[0]),k.parent()[0].insertBefore(A[m],k[0]);k.remove()}return void e.setSelectionToElementEnd(g[0])}if("createlink"===s.toLowerCase()){var M='<a href="'+u+'" target="'+(f.a.target?f.a.target:"")+'">',D="</a>";if(e.getSelection().collapsed)e.insertHtml(M+u+D,i);else if(rangy.getSelection().getRangeAt(0).canSurroundContents()){var H=angular.element(M+D)[0];rangy.getSelection().getRangeAt(0).surroundContents(H)}return}if("inserthtml"===s.toLowerCase())return void e.insertHtml(u,i)}}try{n[0].execCommand(s,d,u)}catch(e){}}}}]).service("taSelection",["$window","$document","taDOM",function(e,t,n){var a=t[0],o=e.rangy,r=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},l={getSelection:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:r(e.startContainer,e.startOffset),end:r(e.endContainer,e.endOffset),collapsed:e.collapsed};return(t=3===t.nodeType?t.parentNode:t).parentNode===n.start.element||t.parentNode===n.end.element?n.container=t.parentNode:n.container=t,n},getOnlySelectedElements:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return l.getSelection().container},setSelection:function(e,t,n){var a=o.createRange();a.setStart(e,t),a.setEnd(e,n),o.getSelection().setSingleRange(a)},setSelectionBeforeElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!1),o.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),o.getSelection().setSingleRange(t)},insertHtml:function(e,t){var r,i,s,d,u,p,m,g=angular.element("<div>"+e+"</div>"),h=o.getSelection().getRangeAt(0),v=a.createDocumentFragment(),y=g[0].childNodes,b=!0;if(y.length>0){for(d=[],s=0;s<y.length;s++)"p"===y[s].nodeName.toLowerCase()&&""===y[s].innerHTML.trim()||3===y[s].nodeType&&""===y[s].nodeValue.trim()||(b=b&&!c.test(y[s].nodeName),d.push(y[s]));for(var x=0;x<d.length;x++)p=v.appendChild(d[x]);!b&&h.collapsed&&/^(|<br(|\/)>)$/i.test(h.startContainer.innerHTML)&&h.selectNode(h.startContainer)}else b=!0,p=v=a.createTextNode(e);if(b)h.deleteContents();else if(h.collapsed&&h.startContainer!==t)if(h.startContainer.innerHTML&&h.startContainer.innerHTML.match(/^<[^>]*>$/i))r=h.startContainer,1===h.startOffset?(h.setStartAfter(r),h.setEndAfter(r)):(h.setStartBefore(r),h.setEndBefore(r));else{if(3===h.startContainer.nodeType&&h.startContainer.parentNode!==t)for(i=(r=h.startContainer.parentNode).cloneNode(),n.splitNodes(r.childNodes,r,i,h.startContainer,h.startOffset);!f.test(r.nodeName);){angular.element(r).after(i);var E=i;i=(r=r.parentNode).cloneNode(),n.splitNodes(r.childNodes,r,i,E)}else i=(r=h.startContainer).cloneNode(),n.splitNodes(r.childNodes,r,i,void 0,void 0,h.startOffset);if(angular.element(r).after(i),h.setStartAfter(r),h.setEndAfter(r),/^(|<br(|\/)>)$/i.test(r.innerHTML.trim())&&(h.setStartBefore(r),h.setEndBefore(r),angular.element(r).remove()),/^(|<br(|\/)>)$/i.test(i.innerHTML.trim())&&angular.element(i).remove(),"li"===r.nodeName.toLowerCase()){for(m=a.createDocumentFragment(),u=0;u<v.childNodes.length;u++)g=angular.element("<li>"),n.transferChildNodes(v.childNodes[u],g[0]),n.transferNodeAttributes(v.childNodes[u],g[0]),m.appendChild(g[0]);v=m,p&&(p=(p=v.childNodes[v.childNodes.length-1]).childNodes[p.childNodes.length-1])}}else h.deleteContents();h.insertNode(v),p&&l.setSelectionToElementEnd(p)}};return l}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var a=[],o=t.children();return o.length&&angular.forEach(o,function(t){a=a.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&a.push(t),a},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,a,o,r,l){if(!o&&isNaN(l))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var i=document.createDocumentFragment(),s=document.createDocumentFragment(),d=0;t.length>0&&(isNaN(l)||l!==d)&&t[0]!==o;)i.appendChild(t[0]),d++;for(!isNaN(r)&&r>=0&&t[0]&&(i.appendChild(document.createTextNode(t[0].nodeValue.substring(0,r))),t[0].nodeValue=t[0].nodeValue.substring(r));t.length>0;)s.appendChild(t[0]);e.transferChildNodes(i,n),e.transferChildNodes(s,a)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=o}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=o}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var a,o=/(^[^<]|>)[^<]/i.exec(n);return o?a=o.index:a=(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"")).indexOf(">"),n=n.trim().substring(a,a+100),!/^[^<>]+$/i.test(n)&&(!(0!==n.length&&n!==t&&!/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n))||!/>\s*[^\s<]/i.test(n)&&!e.test(n))}}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(e,n,r,s,d,u,p,m,g,v,y,b,x,E){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(u,w,S,T){var C,$,N,L,k=T[0],A=T[1]||{},M=void 0!==w.attr("contenteditable")&&w.attr("contenteditable"),D=M||"textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase(),H=!1,B=!1,R=!1,q=S.taUnsafeSanitizer||v.disableSanitizer,W=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,_=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,K=1,z=2,F=4,O=8,I=[{specialKey:"UndoKey",forbiddenModifiers:F+O,mustHaveModifiers:[z+K],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:F,mustHaveModifiers:[z+K,O],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:F+O,mustHaveModifiers:[z+K],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:z+O+F+K,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:z+F+K,mustHaveModifiers:[O],keyCode:9}];void 0===S.taDefaultWrap&&(S.taDefaultWrap="p"),""===S.taDefaultWrap?(N="",L=void 0===t?"<div><br></div>":t>=11?"<p><br></p>":t<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(N=void 0===t||t>=11?"<"+S.taDefaultWrap+"><br></"+S.taDefaultWrap+">":t<=8?"<"+S.taDefaultWrap.toUpperCase()+"></"+S.taDefaultWrap.toUpperCase()+">":"<"+S.taDefaultWrap+"></"+S.taDefaultWrap+">",L=void 0===t||t>=11?"<"+S.taDefaultWrap+"><br></"+S.taDefaultWrap+">":t<=8?"<"+S.taDefaultWrap.toUpperCase()+">&nbsp;</"+S.taDefaultWrap.toUpperCase()+">":"<"+S.taDefaultWrap+">&nbsp;</"+S.taDefaultWrap+">"),A.$options||(A.$options={});var P,V=y(L),U=function(e){if(V(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+S.taDefaultWrap+">"+e+"</"+S.taDefaultWrap+">";else{var n,a=t[0].childNodes,o=!1;for(n=0;n<a.length&&!(o=a[n].nodeName.toLowerCase().match(c));n++);if(o)for(e="",n=0;n<a.length;n++){var r=a[n],l=r.nodeName.toLowerCase();if("#comment"===l)e+="\x3c!--"+r.nodeValue+"--\x3e";else if("#text"===l){var i=r.textContent;e+=i.trim()?"<"+S.taDefaultWrap+">"+i+"</"+S.taDefaultWrap+">":i}else if(l.match(c))e+=r.outerHTML;else{var s=r.outerHTML||r.nodeValue;e+=""!==s.trim()?"<"+S.taDefaultWrap+">"+s+"</"+S.taDefaultWrap+">":s}}else e="<"+S.taDefaultWrap+">"+e+"</"+S.taDefaultWrap+">"}return e};S.taPaste&&($=b(S.taPaste)),w.addClass("ta-bind"),u["$undoManager"+(S.id||"")]=k.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return void 0===e||null===e||void 0!==this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),P&&n.cancel(P),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var j,G=u["$undoTaBind"+(S.id||"")]=function(){if(!H&&M){var e=k.$undoManager.undo();void 0!==e&&null!==e&&(ue(e),Q(e,!1),j&&n.cancel(j),j=n(function(){w[0].focus(),p.setSelectionToElementEnd(w[0])},1))}},Y=u["$redoTaBind"+(S.id||"")]=function(){if(!H&&M){var e=k.$undoManager.redo();void 0!==e&&null!==e&&(ue(e),Q(e,!1),j&&n.cancel(j),j=n(function(){w[0].focus(),p.setSelectionToElementEnd(w[0])},1))}},J=function(){if(M)return w[0].innerHTML;if(D)return w.val();throw"textAngular Error: attempting to update non-editable taBind"},Q=function(e,t,n){R=n||!1,(void 0===t||null===t)&&(t=M),(void 0===e||null===e)&&(e=J()),V(e)?(""!==k.$viewValue&&k.$setViewValue(""),t&&""!==k.$undoManager.current()&&k.$undoManager.push("")):(de(),k.$viewValue!==e&&(k.$setViewValue(e),t&&k.$undoManager.push(e))),k.$render()};u["updateTaBind"+(S.id||"")]=function(){H||Q(void 0,void 0,!0)};var X=function(t){return k.$oldViewValue=e(d(t),k.$oldViewValue,q)};if(w.attr("required")&&(k.$validators.required=function(e,t){return!V(e||t)}),k.$parsers.push(X),k.$parsers.unshift(U),k.$formatters.push(X),k.$formatters.unshift(U),k.$formatters.unshift(function(e){return k.$undoManager.push(e||"")}),D)if(u.events={},M){var Z,ee=!1,te=function(t){if(t&&t.trim().length){if(t.match(/class=["']*Mso(Normal|List)/i)||t.match(/content=["']*Word.Document/i)){var a=t.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);a=(a=a?a[1]:t).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var o=angular.element("<div>"+a+"</div>"),r=angular.element("<div></div>"),l={element:null,lastIndent:[],lastLi:null,isUl:!1};l.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var i=function(e){l.isUl=e,l.element=angular.element(e?"<ul>":"<ol>"),l.lastIndent=[],l.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},l.lastLevelMatch=null},s=0;s<=o[0].childNodes.length;s++)if(o[0].childNodes[s]&&"#text"!==o[0].childNodes[s].nodeName){var d=o[0].childNodes[s].tagName.toLowerCase();if("p"===d||"h1"===d||"h2"===d||"h3"===d||"h4"===d||"h5"===d||"h6"===d){var c=angular.element(o[0].childNodes[s]),f=(c.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(f){if(c[0].childNodes.length<2||c[0].childNodes[1].childNodes.length<1)continue;var m="bullet"===f[1].toLowerCase()||"number"!==f[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(c[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(c[0].childNodes[1].childNodes[0].innerHTML)),g=(c.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),h=parseFloat(g?g[1]:0),v=(c.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(v&&v[2]&&(h=parseInt(v[2])),v&&(!l.lastLevelMatch||v[1]!==l.lastLevelMatch[1])||!f[3]||"first"===f[3].toLowerCase()||null===l.lastIndent.peek()||l.isUl!==m&&l.lastIndent.peek()===h)i(m),r.append(l.element);else if(null!=l.lastIndent.peek()&&l.lastIndent.peek()<h)l.element=angular.element(m?"<ul>":"<ol>"),l.lastLi.append(l.element);else if(null!=l.lastIndent.peek()&&l.lastIndent.peek()>h){for(;null!=l.lastIndent.peek()&&l.lastIndent.peek()>h;)if("li"!==l.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(l.element.parent()[0].tagName.toLowerCase()))break;l.element=l.element.parent(),l.lastIndent.pop()}else l.element=l.element.parent();l.isUl="ul"===l.element[0].tagName.toLowerCase(),m!==l.isUl&&(i(m),r.append(l.element))}l.lastLevelMatch=v,h!==l.lastIndent.peek()&&l.lastIndent.push(h),l.lastLi=angular.element("<li>"),l.element.append(l.lastLi),l.lastLi.html(c.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),c.remove()}else i(!1),r.append(c)}}var y=function(e){for(var t=(e=angular.element(e))[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(r.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&y(e)}),angular.forEach(r.find("font"),y),t=r.html()}else{if((t=t.replace(/<(|\/)meta[^>]*?>/gi,"")).match(/<[^>]*?(ta-bind)[^>]*?>/)){if(t.match(/<[^>]*?(text-angular)[^>]*?>/)){var b=angular.element("<div>"+t+"</div>");b.find("textarea").remove();for(var E=x.getByAttribute(b,"ta-bind"),S=0;S<E.length;S++){for(var T=E[S][0].parentNode.parentNode,C=0;C<E[S][0].childNodes.length;C++)T.parentNode.insertBefore(E[S][0].childNodes[C],T);T.parentNode.removeChild(T)}t=b.html().replace('<br class="Apple-interchange-newline">',"")}}else t.match(/^<span/)&&(t.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(t=t.replace(/<(|\/)span[^>]*?>/gi,"")));t=t.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*) ?> /i.test(t)&&!1===/(<ul(\s.*) ?>|<ol(\s.*) ?>).*<li(\s.*) ?> /i.test(t)&&(t=t.replace(/<li(\s.*) ?>.*<\/li(\s.*) ?>/i,"<ul>$&</ul>")),t=t.replace(/^[ |\u00A0]+/gm,function(e){for(var t="",n=0;n<e.length;n++)t+="&nbsp; ";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp; &nbsp; &nbsp; &nbsp; "),$&&(t=$(u,{$html:t})||t),t=e(t,"",q),p.insertHtml(t,w[0]),n(function(){k.$setViewValue(J()),ee=!1,w.removeClass("processing-paste")},0)}else ee=!1,w.removeClass("processing-paste")};if(w.on("paste",u.events.paste=function(e,t){if(t&&angular.extend(e,t),H||ee)return e.stopPropagation(),e.preventDefault(),!1;ee=!0,w.addClass("processing-paste");var a,o=(e.originalEvent||e).clipboardData;if(o&&o.getData&&o.types.length>0){for(var l="",i=0;i<o.types.length;i++)l+=" "+o.types[i];return/text\/html/i.test(l)?a=o.getData("text/html"):/text\/plain/i.test(l)&&(a=o.getData("text/plain")),te(a),e.stopPropagation(),e.preventDefault(),!1}var d=r.rangy.saveSelection(),u=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');s.find("body").append(u),u[0].focus(),n(function(){r.rangy.restoreSelection(d),te(u[0].innerHTML),w[0].focus(),u.remove()},0)}),w.on("cut",u.events.cut=function(e){H?e.preventDefault():n(function(){k.$setViewValue(J())},0)}),w.on("keydown",u.events.keydown=function(e,t){var n;if(t&&angular.extend(e,t),e.specialKey=function(e){var t;return I.forEach(function(n){if(n.keyCode===e.keyCode){var a=(e.metaKey?z:0)+(e.ctrlKey?K:0)+(e.shiftKey?O:0)+(e.altKey?F:0);if(n.forbiddenModifiers&a)return;n.mustHaveModifiers.every(function(e){return a&e})&&(t=n.specialKey)}}),t}(e),v.keyMappings.forEach(function(t){e.specialKey===t.commandKeyCode&&(e.specialKey=void 0),t.testForKey(e)&&(n=t.commandKeyCode),("UndoKey"===t.commandKeyCode||"RedoKey"===t.commandKeyCode)&&(t.enablePropagation||e.preventDefault())}),void 0!==n&&(e.specialKey=n),void 0===e.specialKey||"UndoKey"===e.specialKey&&"RedoKey"===e.specialKey||(e.preventDefault(),E.sendKeyCommand(u,e)),!H&&("UndoKey"===e.specialKey&&(G(),e.preventDefault()),"RedoKey"===e.specialKey&&(Y(),e.preventDefault()),13===e.keyCode&&!e.shiftKey)){var a,o=p.getSelectionElement();if(!o.tagName.match(f))return;var r=angular.element(N);if(function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}(["blockquote","ul","ol"],o.parentNode.tagName.toLowerCase())){if(/^<br(|\/)>$/i.test(o.innerHTML.trim())&&!o.nextSibling){var l=(a=angular.element(o)).parent();l.after(r),a.remove(),0===l.children().length&&l.remove(),p.setSelectionToElementStart(r[0]),e.preventDefault()}/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(o.innerHTML.trim())&&((a=angular.element(o)).after(r),a.remove(),p.setSelectionToElementStart(r[0]),e.preventDefault())}}}),w.on("keyup",u.events.keyup=function(e,t){if(t&&angular.extend(e,t),9!==e.keyCode){if(P&&n.cancel(P),!H&&!W.test(e.keyCode)){if(""!==N&&13===e.keyCode&&!e.shiftKey){for(var a=p.getSelectionElement();!a.tagName.match(f)&&a!==w[0];)a=a.parentNode;if(a.tagName.toLowerCase()!==S.taDefaultWrap&&"li"!==a.tagName.toLowerCase()&&(""===a.innerHTML.trim()||" <br>"===a.innerHTML.trim())){var o=angular.element(N);angular.element(a).replaceWith(o),p.setSelectionToElementStart(o[0])}}var r=J();""!==N&&""===r.trim()?(ue(N),p.setSelectionToElementStart(w.children()[0])):" < "!==r.substring(0,1)&&S.taDefaultWrap;var l=C!==e.keyCode&&_.test(e.keyCode);Z&&n.cancel(Z),Z=n(function(){Q(r,l,!0)},A.$options.debounce||400),l||(P=n(function(){k.$undoManager.push(r)},250)),C=e.keyCode}}else p.getSelection().start.element===w[0]&&w.children().length&&p.setSelectionToElementStart(w.children()[0])}),w.on("blur",u.events.blur=function(){B=!1,H?(R=!0,k.$render()):Q(void 0,void 0,!0)}),S.placeholder&&(t>8||void 0===t)){var ne;if(!S.id)throw"textAngular Error: An unique ID is required for placeholders to work";ne=l("#"+S.id+".placeholder-text: before",'content: "'+S.placeholder+'"'),u.$on("$destroy",function(){i(ne)})}w.on("focus",u.events.focus=function(){B=!0,w.removeClass("placeholder-text"),de()}),w.on("mouseup",u.events.mouseup=function(){p.getSelection().start.element===w[0]&&w.children().length&&p.setSelectionToElementStart(w.children()[0])}),w.on("mousedown",u.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{w.on("change blur",u.events.change=u.events.blur=function(){H||k.$setViewValue(J())}),w.on("keydown",u.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,o=w.val();if(e.shiftKey){var r=o.lastIndexOf("\n",n),l=o.lastIndexOf("\t",n);-1!==l&&l>=r&&(w.val(o.substring(0,l)+o.substring(l+1)),this.selectionStart=this.selectionEnd=n-1)}else w.val(o.substring(0,n)+"\t"+o.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var ae=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},oe=function(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])},re=function(e,t){var n="",a=e.childNodes;return n+=ae("\t",++t-1)+e.outerHTML.substring(0,4),oe(a,function(e,a){var o=a.nodeName.toLowerCase();return"#comment"===o?void(n+=" \x3c!--"+a.nodeValue+"--\x3e "):"#text"===o?void(n+=a.textContent):void(a.outerHTML&&(n+="ul"===o||"ol"===o?"\n"+re(a,t):"\n"+ae("\t",t)+a.outerHTML))}),n+="\n"+ae("\t",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf(" <"))};k.$formatters.unshift(function(e){var t=angular.element("<div> "+e+" </div>")[0].childNodes;return t.length>0&&(e="",oe(t,function(t,n){var a=n.nodeName.toLowerCase();return"#comment"===a?void(e+="\x3c!--"+n.nodeValue+"--\x3e"):"#text"===a?void(e+=n.textContent):void(n.outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===a||"ol"===a?""+re(n,0):""+n.outerHTML))})),e})}var le,ie=function(e){return u.$emit("ta-element-select",this),e.preventDefault(),!1},se=function(e,t){var a;(t&&angular.extend(e,t),h||H)||(h=!0,a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,u.$emit("ta-drop-event",this,e,a),n(function(){h=!1,Q(void 0,void 0,!0)},100))},de=u["reApplyOnSelectorHandlers"+(S.id||"")]=function(){H||angular.forEach(m,function(e){w.find(e).off("click",ie).on("click",ie)})},ue=function(e){w[0].innerHTML=e},ce=!1;k.$render=function(){if(!ce){ce=!0;var e=k.$viewValue||"";R||(M&&B&&(w.removeClass("placeholder-text"),le&&n.cancel(le),le=n(function(){B||(w[0].focus(),p.setSelectionToElementEnd(w.children()[w.children().length-1])),le=void 0},1)),M?(ue((S.placeholder,""===e?N:e)),H?w.off("drop",se):(de(),w.on("drop",se))):"textarea"!==w[0].tagName.toLowerCase()&&"input"!==w[0].tagName.toLowerCase()?ue(g(e)):w.val(e)),M&&S.placeholder&&(""===e?B?w.removeClass("placeholder-text"):w.addClass("placeholder-text"):w.removeClass("placeholder-text")),ce=R=!1}},S.taReadonly&&((H=u.$eval(S.taReadonly))?(w.addClass("ta-readonly"),("textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase())&&w.attr("disabled","disabled"),void 0!==w.attr("contenteditable")&&w.attr("contenteditable")&&w.removeAttr("contenteditable")):(w.removeClass("ta-readonly"),"textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase()?w.removeAttr("disabled"):M&&w.attr("contenteditable","true")),u.$watch(S.taReadonly,function(e,t){t!==e&&(e?(w.addClass("ta-readonly"),("textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase())&&w.attr("disabled","disabled"),void 0!==w.attr("contenteditable")&&w.attr("contenteditable")&&w.removeAttr("contenteditable"),angular.forEach(m,function(e){w.find(e).on("click",ie)}),w.off("drop",se)):(w.removeClass("ta-readonly"),"textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase()?w.removeAttr("disabled"):M&&w.attr("contenteditable","true"),angular.forEach(m,function(e){w.find(e).off("click",ie)}),w.on("drop",se)),H=e)})),M&&!H&&(angular.forEach(m,function(e){w.find(e).on("click",ie)}),w.on("drop",se),w.on("blur",function(){a&&(o=!0)}))}}}]);var h=!1,v=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);v.config([function(){angular.forEach(n,function(e,t){delete n[t]})}]),v.run([function(){if("function"==typeof define&&define.amd)define(function(e){window.rangy=e("rangy"),window.rangy.saveSelection=e("rangy/lib/rangy-selectionsaverestore")});else if("function"==typeof require&&"undefined"!=typeof module&&"object"==typeof e)window.rangy=require("rangy"),window.rangy.saveSelection=require("rangy/lib/rangy-selectionsaverestore");else{if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly."}}]),v.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(e,t,n,a,o,r,l,i,s,d,u,c){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(p,f,m,g){var h,v,y,b,x,E,w,S,T,C,$,N=m.serial?m.serial:Math.floor(1e16*Math.random());p._name=m.name?m.name:"textAngularEditor"+N;var L=function(e,n,a){t(function(){var t=function(){e.off(n,t),a.apply(this,arguments)};e.on(n,t)},100)};if(T=o(m.taDefaultWrap),angular.extend(p,angular.copy(n),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?p["$undoTaBindtaTextElement"+N]():"redo"===e.toLowerCase()?p["$redoTaBindtaTextElement"+N]():(T(e,!1,t,p.defaultTagAttributes),n&&p["reApplyOnSelectorHandlerstaTextElement"+N](),p.displayElements.text[0].focus())},showHtml:p.$eval(m.taShowHtml)||!1}),m.taFocussedClass&&(p.classes.focussed=m.taFocussedClass),m.taTextEditorClass&&(p.classes.textEditor=m.taTextEditorClass),m.taHtmlEditorClass&&(p.classes.htmlEditor=m.taHtmlEditorClass),m.taDefaultTagAttributes)try{angular.extend(p.defaultTagAttributes,angular.fromJson(m.taDefaultTagAttributes))}catch(e){d.error(e)}m.taTextEditorSetup&&(p.setup.textEditorSetup=p.$parent.$eval(m.taTextEditorSetup)),m.taHtmlEditorSetup&&(p.setup.htmlEditorSetup=p.$parent.$eval(m.taHtmlEditorSetup)),m.taFileDrop?p.fileDropHandler=p.$parent.$eval(m.taFileDrop):p.fileDropHandler=p.defaultFileDropHandler,w=f[0].innerHTML,f[0].innerHTML="",p.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},p.displayElements.popover.append(p.displayElements.popoverArrow),p.displayElements.popover.append(p.displayElements.popoverContainer),p.displayElements.scrollWindow.append(p.displayElements.popover),p.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),p.showPopover=function(e){p.displayElements.popover.css("display","block"),p.reflowPopover(e),s.addClass(p.displayElements.popover,"in"),L(i.find("body"),"click keyup",function(){p.hidePopover()})},p.reflowPopover=function(e){p.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(p.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+p.displayElements.scrollWindow[0].scrollTop+"px"),p.displayElements.popover.removeClass("top").addClass("bottom")):(p.displayElements.popover.css("top",e[0].offsetTop-54+p.displayElements.scrollWindow[0].scrollTop+"px"),p.displayElements.popover.removeClass("bottom").addClass("top"));var t=p.displayElements.text[0].offsetWidth-p.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-p.displayElements.popover[0].offsetWidth/2;p.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),p.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},p.hidePopover=function(){p.displayElements.popover.css("display",""),p.displayElements.popoverContainer.attr("style",""),p.displayElements.popoverContainer.attr("class","popover-content"),p.displayElements.popover.removeClass("in")},p.displayElements.resize.overlay.append(p.displayElements.resize.background),angular.forEach(p.displayElements.resize.anchors,function(e){p.displayElements.resize.overlay.append(e)}),p.displayElements.resize.overlay.append(p.displayElements.resize.info),p.displayElements.scrollWindow.append(p.displayElements.resize.overlay),p.reflowResizeOverlay=function(e){e=angular.element(e)[0],p.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),p.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},p.showResizeOverlay=function(e){var t=i.find("body");C=function(n){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===a.width||isNaN(a.width))&&(a.width=e[0].offsetWidth),(void 0===a.height||isNaN(a.height))&&(a.height=e[0].offsetHeight),p.hidePopover();var o=a.height/a.width,r=function(t){function n(e){return Math.round(Math.max(0,e))}var r={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))},l=void 0!==m.taResizeForceAspectRatio,i=m.taResizeMaintainAspectRatio;if(l||i&&!t.shiftKey){var s=r.y/r.x;r.x=o>s?r.x:r.y/o,r.y=o>s?r.x*o:r.y}var d=angular.element(e);d.css("height",n(r.y)+"px"),d.css("width",n(r.x)+"px"),p.reflowResizeOverlay(e)};t.on("mousemove",r),L(t,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),t.off("mousemove",r),p.$apply(function(){p.hidePopover(),p.updateTaBindtaTextElement()},100)}),n.stopPropagation(),n.preventDefault()},p.displayElements.resize.anchors[3].off("mousedown"),p.displayElements.resize.anchors[3].on("mousedown",C),p.reflowResizeOverlay(e),L(t,"click",function(){p.hideResizeOverlay()})},p.hideResizeOverlay=function(){p.displayElements.resize.anchors[3].off("mousedown",C),p.displayElements.resize.overlay.css("display","")},p.setup.htmlEditorSetup(p.displayElements.html),p.setup.textEditorSetup(p.displayElements.text),p.displayElements.html.attr({id:"taHtmlElement"+N,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":f.attr("ng-model-options")}),p.displayElements.text.attr({id:"taTextElement"+N,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":f.attr("ng-model-options")}),p.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),m.taDefaultWrap&&p.displayElements.text.attr("ta-default-wrap",m.taDefaultWrap),m.taUnsafeSanitizer&&(p.displayElements.text.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer),p.displayElements.html.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer)),p.displayElements.scrollWindow.append(p.displayElements.text),f.append(p.displayElements.scrollWindow),f.append(p.displayElements.html),p.displayElements.forminput.attr("name",p._name),f.append(p.displayElements.forminput),m.tabindex&&(f.removeAttr("tabindex"),p.displayElements.text.attr("tabindex",m.tabindex),p.displayElements.html.attr("tabindex",m.tabindex)),m.placeholder&&(p.displayElements.text.attr("placeholder",m.placeholder),p.displayElements.html.attr("placeholder",m.placeholder)),m.taDisabled&&(p.displayElements.text.attr("ta-readonly","disabled"),p.displayElements.html.attr("ta-readonly","disabled"),p.disabled=p.$parent.$eval(m.taDisabled),p.$parent.$watch(m.taDisabled,function(e){p.disabled=e,p.disabled?f.addClass(p.classes.disabled):f.removeClass(p.classes.disabled)})),m.taPaste&&(p._pasteHandler=function(e){return c(m.taPaste)(p.$parent,{$html:e})},p.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(p.displayElements.scrollWindow)(p),e(p.displayElements.html)(p),p.updateTaBindtaTextElement=p["updateTaBindtaTextElement"+N],p.updateTaBindtaHtmlElement=p["updateTaBindtaHtmlElement"+N],f.addClass("ta-root"),p.displayElements.scrollWindow.addClass("ta-text ta-editor "+p.classes.textEditor),p.displayElements.html.addClass("ta-html ta-editor "+p.classes.htmlEditor),p._actionRunning=!1;var k=!1;if(p.startAction=function(){return p._actionRunning=!0,k=l.rangy.saveSelection(),function(){k&&l.rangy.restoreSelection(k)}},p.endAction=function(){p._actionRunning=!1,k&&(p.showHtml?p.displayElements.html[0].focus():p.displayElements.text[0].focus(),l.rangy.removeMarkers(k)),k=!1,p.updateSelectedStyles(),p.showHtml||p["updateTaBindtaTextElement"+N]()},x=function(){p.focussed=!0,f.addClass(p.classes.focussed),S.focus(),f.triggerHandler("focus")},p.displayElements.html.on("focus",x),p.displayElements.text.on("focus",x),E=function(e){return p._actionRunning||i[0].activeElement===p.displayElements.html[0]||i[0].activeElement===p.displayElements.text[0]||(f.removeClass(p.classes.focussed),S.unfocus(),t(function(){p._bUpdateSelectedStyles=!1,f.triggerHandler("blur"),p.focussed=!1},0)),e.preventDefault(),!1},p.displayElements.html.on("blur",E),p.displayElements.text.on("blur",E),p.displayElements.text.on("paste",function(e){f.triggerHandler("paste",e)}),p.queryFormatBlockState=function(e){return!p.showHtml&&e.toLowerCase()===i[0].queryCommandValue("formatBlock").toLowerCase()},p.queryCommandState=function(e){return p.showHtml?"":i[0].queryCommandState(e)},p.switchView=function(){p.showHtml=!p.showHtml,s.enabled(!1,p.displayElements.html),s.enabled(!1,p.displayElements.text),p.showHtml?t(function(){return s.enabled(!0,p.displayElements.html),s.enabled(!0,p.displayElements.text),p.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,p.displayElements.html),s.enabled(!0,p.displayElements.text),p.displayElements.text[0].focus()},100)},m.ngModel){var A=!0;g.$render=function(){if(A){A=!1;var e=p.$parent.$eval(m.ngModel);void 0!==e&&null!==e||!w||""===w||g.$setViewValue(w)}p.displayElements.forminput.val(g.$viewValue),p.html=g.$viewValue||""},f.attr("required")&&(g.$validators.required=function(e,t){var n=e||t;return!(!n||""===n.trim())})}else p.displayElements.forminput.val(w),p.html=w;if(p.$watch("html",function(e,t){e!==t&&(m.ngModel&&g.$viewValue!==e&&g.$setViewValue(e),p.displayElements.forminput.val(e))}),m.taTargetToolbars)S=r.registerEditor(p._name,p,m.taTargetToolbars.split(","));else{var M=angular.element('<div text-angular-toolbar name="textAngularToolbar'+N+'">');m.taToolbar&&M.attr("ta-toolbar",m.taToolbar),m.taToolbarClass&&M.attr("ta-toolbar-class",m.taToolbarClass),m.taToolbarGroupClass&&M.attr("ta-toolbar-group-class",m.taToolbarGroupClass),m.taToolbarButtonClass&&M.attr("ta-toolbar-button-class",m.taToolbarButtonClass),m.taToolbarActiveButtonClass&&M.attr("ta-toolbar-active-button-class",m.taToolbarActiveButtonClass),m.taFocussedClass&&M.attr("ta-focussed-class",m.taFocussedClass),f.prepend(M),e(M)(p.$parent),S=r.registerEditor(p._name,p,["textAngularToolbar"+N])}p.$on("$destroy",function(){r.unregisterEditor(p._name),angular.element(window).off("blur")}),p.$on("ta-element-select",function(e,t){S.triggerElementSelect(e,t)&&p["reApplyOnSelectorHandlerstaTextElement"+N]()}),p.$on("ta-drop-event",function(e,n,a,o){p.displayElements.text[0].focus(),o&&o.files&&o.files.length>0?(angular.forEach(o.files,function(e){try{u.when(p.fileDropHandler(e,p.wrapSelection)||p.fileDropHandler!==p.defaultFileDropHandler&&u.when(p.defaultFileDropHandler(e,p.wrapSelection))).then(function(){p["updateTaBindtaTextElement"+N]()})}catch(e){d.error(e)}}),a.preventDefault(),a.stopPropagation()):t(function(){p["updateTaBindtaTextElement"+N]()},0)}),p._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){p._bUpdateSelectedStyles=!1,p.focussed=!1}),p.updateSelectedStyles=function(){var e;$&&t.cancel($),void 0!==(e=a.getSelectionElement())&&e.parentNode!==p.displayElements.text[0]?S.updateSelectedStyles(angular.element(e)):S.updateSelectedStyles(),p._bUpdateSelectedStyles&&($=t(p.updateSelectedStyles,200))},h=function(){return p.focussed?void(p._bUpdateSelectedStyles||(p._bUpdateSelectedStyles=!0,p.$apply(function(){p.updateSelectedStyles()}))):void(p._bUpdateSelectedStyles=!1)},p.displayElements.html.on("keydown",h),p.displayElements.text.on("keydown",h),v=function(){p._bUpdateSelectedStyles=!1},p.displayElements.html.on("keyup",v),p.displayElements.text.on("keyup",v),y=function(e,t){t&&angular.extend(e,t),p.$apply(function(){return S.sendKeyCommand(e)?(p._bUpdateSelectedStyles||p.updateSelectedStyles(),e.preventDefault(),!1):void 0})},p.displayElements.html.on("keypress",y),p.displayElements.text.on("keypress",y),b=function(){p._bUpdateSelectedStyles=!1,p.$apply(function(){p.updateSelectedStyles()})},p.displayElements.html.on("mouseup",b),p.displayElements.text.on("mouseup",b)}}}]),v.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,n){var a={},o={};return{registerEditor:function(n,r,l){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!r)throw"textAngular Error: An editor requires a scope";if(o[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';var i=[];return angular.forEach(l,function(e){a[e]&&i.push(a[e])}),o[n]={scope:r,toolbars:l,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&i.push(e)},editorFunctions:{disable:function(){angular.forEach(i,function(e){e.disabled=!0})},enable:function(){angular.forEach(i,function(e){e.disabled=!1})},focus:function(){angular.forEach(i,function(e){e._parent=r,e.disabled=!1,e.focussed=!0,r.focussed=!0})},unfocus:function(){angular.forEach(i,function(e){e.disabled=!0,e.focussed=!1}),r.focussed=!1},updateSelectedStyles:function(e){angular.forEach(i,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=r,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var a=!1;return(n.ctrlKey||n.metaKey||n.specialKey)&&angular.forEach(t,function(t,o){if(t.commandKeyCode&&(t.commandKeyCode===n.which||t.commandKeyCode===n.specialKey))for(var l=0;l<i.length;l++)if(void 0!==i[l].tools[o]){e.call(i[l].tools[o],r),a=!0;break}}),a},triggerElementSelect:function(e,n){var a=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},o=[],l={},s=!1;n=angular.element(n);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),(!e.onElementSelect.onlyWithAttrs||a(n,e.onElementSelect.onlyWithAttrs))&&(l[t]=e))}),d?(angular.forEach(l,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&o.push({name:t,tool:e})}),o.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(l,function(e,t){o.push({name:t,tool:e})}),o.length>0)for(var u=0;u<o.length;u++){for(var c=o[u].tool,p=o[u].name,f=0;f<i.length;f++)if(void 0!==i[f].tools[p]){c.onElementSelect.action.call(i[f].tools[p],e,n,r),s=!0;break}if(s)break}return s}}},o[n].editorFunctions},retrieveEditor:function(e){return o[e]},unregisterEditor:function(e){delete o[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(a[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';a[e.name]=e,angular.forEach(o,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return a[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete a[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)})},updateToolDisplay:function(e,t){var n=this;angular.forEach(a,function(a,o){n.updateToolbarToolDisplay(o,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(a,function(n,a){t.resetToolbarToolDisplay(a,e)})},updateToolbarToolDisplay:function(e,t,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(a,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var a,o=0;o<t.toolbar[n].length;o++){if(t.toolbar[n][o]===e){a={group:n,index:o};break}if(void 0!==a)break}void 0!==a&&(t.toolbar[a.group].slice(a.index,1),t._$element.children().eq(a.group).children().eq(a.index).remove())}})},addTool:function(e,t,o,r){n(e,t),angular.forEach(a,function(n){n.addTool(e,t,o,r)})},addToolToToolbar:function(e,t,o,r,l){n(e,t),a[o].addTool(e,t,r,l)},refreshEditor:function(e){if(!o[e])throw'textAngular Error: No Editor with name "'+e+'" exists';o[e].scope.updateTaBindtaTextElement(),o[e].scope.$$phase||o[e].scope.$digest()},sendKeyCommand:function(e,t){var n=o[e._name];return n&&n.editorFunctions.sendKeyCommand(t)?(e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1):void 0}}}]),v.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,a,o,r){return{scope:{name:"@"},restrict:"EA",link:function(l,i,s){if(!l.name||""===l.name)throw"textAngular Error: A toolbar requires a name";angular.extend(l,angular.copy(n)),s.taToolbar&&(l.toolbar=l.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(l.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(l.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(l.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(l.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(l.classes.focussed=s.taFocussedClass),l.disabled=!0,l.focussed=!1,l._$element=i,i[0].innerHTML="",i.addClass("ta-toolbar "+l.classes.toolbar),l.$watch("focussed",function(){l.focussed?i.addClass(l.classes.focussed):i.removeClass(l.classes.focussed)});var d=function(t,n){var a;if(a=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t.class?a.addClass(t.class):a.addClass(l.classes.toolbarButton),a.attr("name",n.name),a.attr("ta-button","ta-button"),a.attr("ng-disabled","isDisabled()"),a.attr("tabindex","-1"),a.attr("ng-click","executeAction()"),a.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&a.attr("title",t.tooltiptext),t&&!t.display&&!n._display&&(a[0].innerHTML="",t.buttontext&&(a[0].innerHTML=t.buttontext),t.iconclass)){var o=angular.element("<i>"),r=a[0].innerHTML;o.addClass(t.iconclass),a[0].innerHTML="",a.append(o),r&&""!==r&&a.append("&nbsp;"+r)}return n._lastToolDefinition=angular.copy(t),e(a)(n)};l.tools={},l._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var u={$window:r,$editor:function(){return l._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?l.classes.toolbarButtonActive:""},executeAction:o};angular.forEach(l.toolbar,function(e){var t=angular.element("<div>");t.addClass(l.classes.toolbarGroup),angular.forEach(e,function(e){l.tools[e]=angular.extend(l.$new(!0),a[e],u,{name:e}),l.tools[e].$element=d(a[e],l.tools[e]),t.append(l.tools[e].$element)}),i.append(t)}),l.updateToolDisplay=function(e,t,n){var a=l.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var o=d(t,a);a.$element.replaceWith(o),a.$element=o}},l.addTool=function(e,t,n,o){var r;l.tools[e]=angular.extend(l.$new(!0),a[e],u,{name:e}),l.tools[e].$element=d(a[e],l.tools[e]),void 0===n&&(n=l.toolbar.length-1),r=angular.element(i.children()[n]),void 0===o?(r.append(l.tools[e].$element),l.toolbar[n][l.toolbar[n].length-1]=e):(r.children().eq(o).after(l.tools[e].$element),l.toolbar[n][o]=e)},t.registerToolbar(l),l.$on("$destroy",function(){t.unregisterToolbar(l.name)})}}}])}()}({});