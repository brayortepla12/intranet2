!function(t){var e={settings:{licenceString:"",bitmapSettings:{width:640,height:480,paddingX:0,paddingY:0,inkWidth:.7},output:!1,sdkDetectTimeout:1500,servicePort:8e3},data:{sdk:null,txtSignature:null,who:null,why:null,when:null,imageBase64:null},init:function(a,n){e.settings=t.extend(!0,e.settings,a),i(n)},clearSignature:function t(){if(null===n)return void i(t);n.Clear(function(n,r){e.data.sdk.ResponseStatus.OK!==r&&(a("ClearSignature() error: "+r),e.data.sdk.ResponseStatus.INVALID_SESSION===r&&(a("Session error. Restarting the session."),i(t)))})},capture:function u(d,o){if(null===e.data.sdk||!e.data.sdk.running||null===s)return a("Session error. Restarting the session."),void i(function(){u(d,o)});e.data.imageBase64=null;s.Capture(r,d,o,null,null,function(r,s,c){if(e.data.sdk.ResponseStatus.INVALID_SESSION===c)a("Error: invalid session. Restarting the session."),i(function(){u(d,o)});else{e.data.sdk.DynamicCaptureResult.DynCaptOK!==c&&a("Capture returned: "+c);var p=!1;switch(c){case e.data.sdk.DynamicCaptureResult.DynCaptOK:n=s,a("Signature captured successfully"),l(n,g);break;case e.data.sdk.DynamicCaptureResult.DynCaptCancel:a("Signature capture cancelled"),t(window).trigger("sigCapt:captureCancelled",[e]);break;case e.data.sdk.DynamicCaptureResult.DynCaptPadError:p=["No capture service available",c];break;case e.data.sdk.DynamicCaptureResult.DynCaptError:p=["Tablet Error",c];break;case e.data.sdk.DynamicCaptureResult.DynCaptIntegrityKeyInvalid:p=["The integrity key parameter is invalid (obsolete)",c];break;case e.data.sdk.DynamicCaptureResult.DynCaptNotLicensed:p=["No valid Signature Capture licence found",c];break;case e.data.sdk.DynamicCaptureResult.DynCaptAbort:p=["Error - unable to parse document contents",c];break;default:p=["Capture Error",c]}!1!==p&&(p[2]=e,t(window).trigger("sigCapt:captureError",p),a("Error ("+p[1]+"): "+p[0]))}});function g(r,s,i){e.data.sdk.ResponseStatus.OK===i?(e.data.imageBase64="data:image/png;base64,"+s,t(window).trigger("sigCapt:renderBitmap",[e.data.imageBase64,r,e]),n.GetSigText(c)):a("Signature Render Bitmap error: "+i)}function c(n,r,s){e.data.sdk.ResponseStatus.OK===s?function(a){e.data.txtSignature!==a&&(e.data.txtSignature=a,t(window).trigger("sigCapt:txtSignatureUpdated",[a,e]))}(r):a("Signature Render Bitmap error: "+s)}},displaySignatureDetails:function r(){if(!e.data.sdk.running||null===n)return a("Session error. Restarting the session."),void i(r);e.data.who=null;e.data.why=null;e.data.when=null;n.GetIsCaptured(function(t,n,u){if(e.data.sdk.ResponseStatus.OK===u){if(!n)return void a("No signature has been captured yet.");t.GetWho(s)}else a("Signature GetWho error: "+u),e.data.sdk.ResponseStatus.INVALID_SESSION===u&&(a("Session error. Restarting the session."),i(r))});function s(t,r,s){if(e.data.sdk.ResponseStatus.OK===s){a("\tName:\t "+r),e.data.who=r;var i=e.data.sdk.TimeZone.TimeLocal;n.GetWhen(i,u)}else a("Signature GetWho error: "+s)}function u(t,r,s){e.data.sdk.ResponseStatus.OK===s?(a("\tDate:\t "+r.toString()),e.data.when=r.toString(),n.GetWhy(d)):a("Signature GetWhen error: "+s)}function d(n,r,s){e.data.sdk.ResponseStatus.OK===s?(a("\tReason: "+r),e.data.why=r,t(window).trigger("sigCapt:signatureDetails",[e.data.who,e.data.why,e.data.when,e])):a("Signature GetWhy error: "+s)}},setSignatureText:function r(s){if(null===n)return void i(function(){r(s)});n.PutSigText(s,function(t,d){e.data.sdk.ResponseStatus.OK===d?l(n,u):(a("SetSignatureText() error: "+d),e.data.sdk.ResponseStatus.INVALID_SESSION===d&&(a("Session error. Restarting the session."),i(function(){r(s)})))});function u(n,r,s){e.data.sdk.ResponseStatus.OK===s?(e.data.imageBase64="data:image/png;base64,"+r,t(window).trigger("sigCapt:renderBitmap",[e.data.imageBase64,n,e])):a("Signature Render Bitmap error: "+s)}},restartSession:i};function a(t){!0===e.settings.output?console.info("SigCapt:",t):"[object Function]"===Object.prototype.toString.call(e.settings.output)&&e.settings.output(t)}window.SigCapt=e;var n=null,r=null,s=null;function i(i){t(window).trigger("sigCapt:restartSession",[e]),e.data.sdk=null,n=null,r=null,s=null;var u=setTimeout(function(){e.data.sdk.running?(a("Signature SDK Service detected."),d()):(a("Signature SDK Service not detected."),t(window).trigger("sigCapt:noSdkDetected",[e]))},e.settings.sdkDetectTimeout);function d(){e.data.sdk.running&&(r=new e.data.sdk.SigCtl(o))}function o(t,n){e.data.sdk.ResponseStatus.OK===n?e.settings.licenceString.length>0?r.PutLicence(e.settings.licenceString,g):s=new e.data.sdk.DynamicCapture(l):a("SigCtl constructor error: "+n)}function g(t,n){e.data.sdk.ResponseStatus.OK===n?s=new e.data.sdk.DynamicCapture(l):a("SigCtl constructor error: "+n)}function l(t,n){e.data.sdk.ResponseStatus.OK===n?r.GetSignature(c):a("DynCapt constructor error: "+n)}function c(t,s,i){e.data.sdk.ResponseStatus.OK===i?(n=s,r.GetProperty("Component_FileVersion",p)):a("SigCapt GetSignature error: "+i)}function p(t,n,r){e.data.sdk.ResponseStatus.OK===r?(a("DLL: flSigCOM.dll\tv"+n.text),s.GetProperty("Component_FileVersion",S)):a("SigCtl GetProperty error: "+r)}function S(n,r,s){e.data.sdk.ResponseStatus.OK===s?(a("DLL: flSigCapt.dll v"+r.text),a("Ready."),"function"==typeof i&&i(),t(window).trigger("sigCapt:ready",[e])):a("DynCapt GetProperty error: "+s)}e.data.sdk=new WacomGSS_SignatureSDK(function(){e.data.sdk.running?(a("Signature SDK Service detected."),clearTimeout(u),d()):a("Signature SDK Service not detected.")},e.settings.servicePort),e.data.txtSignature=null,e.data.who=null,e.data.why=null,e.data.when=null,e.data.imageBase64=null}function u(a){if(e.data.txtSignature!==a){e.data.txtSignature=a;t(window).trigger("sigCapt:txtSignatureUpdated",[a,e])}}function d(o,g){if(e.data.sdk===null||!e.data.sdk.running||null===s){a("Session error. Restarting the session.");i(function(){d(o,g)});return}e.data.imageBase64=null;s.Capture(r,o,g,null,null,c);function c(r,s,u){if(e.data.sdk.ResponseStatus.INVALID_SESSION===u){a("Error: invalid session. Restarting the session.");i(function(){d(o,g)})}else{if(e.data.sdk.DynamicCaptureResult.DynCaptOK!==u){a("Capture returned: "+u)}var c=false;switch(u){case e.data.sdk.DynamicCaptureResult.DynCaptOK:n=s;a("Signature captured successfully");l(n,p);break;case e.data.sdk.DynamicCaptureResult.DynCaptCancel:a("Signature capture cancelled");t(window).trigger("sigCapt:captureCancelled",[e]);break;case e.data.sdk.DynamicCaptureResult.DynCaptPadError:c=["No capture service available",u];break;case e.data.sdk.DynamicCaptureResult.DynCaptError:c=["Tablet Error",u];break;case e.data.sdk.DynamicCaptureResult.DynCaptIntegrityKeyInvalid:c=["The integrity key parameter is invalid (obsolete)",u];break;case e.data.sdk.DynamicCaptureResult.DynCaptNotLicensed:c=["No valid Signature Capture licence found",u];break;case e.data.sdk.DynamicCaptureResult.DynCaptAbort:c=["Error - unable to parse document contents",u];break;default:c=["Capture Error",u];break}if(c!==false){c[2]=e;t(window).trigger("sigCapt:captureError",c);a("Error ("+c[1]+"): "+c[0])}}}function p(r,s,i){if(e.data.sdk.ResponseStatus.OK===i){e.data.imageBase64="data:image/png;base64,"+s;t(window).trigger("sigCapt:renderBitmap",[e.data.imageBase64,r,e]);n.GetSigText(S)}else{a("Signature Render Bitmap error: "+i)}}function S(t,n,r){if(e.data.sdk.ResponseStatus.OK===r){u(n)}else{a("Signature Render Bitmap error: "+r)}}}function o(){if(!e.data.sdk.running||null===n){a("Session error. Restarting the session.");i(o);return}e.data.who=null;e.data.why=null;e.data.when=null;n.GetIsCaptured(r);function r(t,n,r){if(e.data.sdk.ResponseStatus.OK===r){if(!n){a("No signature has been captured yet.");return}t.GetWho(s)}else{a("Signature GetWho error: "+r);if(e.data.sdk.ResponseStatus.INVALID_SESSION===r){a("Session error. Restarting the session.");i(o)}}}function s(t,r,s){if(e.data.sdk.ResponseStatus.OK===s){a("\tName:\t "+r);e.data.who=r;var i=e.data.sdk.TimeZone.TimeLocal;n.GetWhen(i,u)}else{a("Signature GetWho error: "+s)}}function u(t,r,s){if(e.data.sdk.ResponseStatus.OK===s){a("\tDate:\t "+r.toString());e.data.when=r.toString();n.GetWhy(d)}else{a("Signature GetWhen error: "+s)}}function d(n,r,s){if(e.data.sdk.ResponseStatus.OK===s){a("\tReason: "+r);e.data.why=r;t(window).trigger("sigCapt:signatureDetails",[e.data.who,e.data.why,e.data.when,e])}else{a("Signature GetWhy error: "+s)}}}function g(){if(null===n){i(g);return}n.Clear(t);function t(t,n){if(e.data.sdk.ResponseStatus.OK!==n){a("ClearSignature() error: "+n);if(e.data.sdk.ResponseStatus.INVALID_SESSION===n){a("Session error. Restarting the session.");i(g)}}}}function l(t,a){t.RenderBitmap("png",e.settings.bitmapSettings.width,e.settings.bitmapSettings.height,e.settings.bitmapSettings.inkWidth,0,16777215,e.data.sdk.RBFlags.RenderOutputBase64|e.data.sdk.RBFlags.RenderColor32BPP|e.data.sdk.RBFlags.RenderBackgroundTransparent,e.settings.bitmapSettings.paddingX,e.settings.bitmapSettings.paddingY,a)}function c(r){if(null===n){i(function(){c(r)});return}n.PutSigText(r,s);function s(t,s){if(e.data.sdk.ResponseStatus.OK===s){l(n,u)}else{a("SetSignatureText() error: "+s);if(e.data.sdk.ResponseStatus.INVALID_SESSION===s){a("Session error. Restarting the session.");i(function(){c(r)})}}}function u(n,r,s){if(e.data.sdk.ResponseStatus.OK===s){e.data.imageBase64="data:image/png;base64,"+r;t(window).trigger("sigCapt:renderBitmap",[e.data.imageBase64,n,e])}else{a("Signature Render Bitmap error: "+s)}}}}(jQuery);