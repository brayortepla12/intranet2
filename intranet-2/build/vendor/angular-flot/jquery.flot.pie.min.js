!function(e){var i=10,s=.95,t={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:function(t){function r(i){M||(M=!0,d=i.getCanvas(),f=e(d).parent(),v=i.getOptions(),i.setData(function(i){for(var s=0,t=0,r=0,a=v.series.pie.combine.color,l=[],n=0;n<i.length;++n){var o=i[n].data;e.isArray(o)&&1==o.length&&(o=o[0]),e.isArray(o)?o[1]=!isNaN(parseFloat(o[1]))&&isFinite(o[1])?+o[1]:0:o=!isNaN(parseFloat(o))&&isFinite(o)?[1,+o]:[1,0],i[n].data=[o]}for(var n=0;n<i.length;++n)s+=i[n].data[0][1];for(var n=0;n<i.length;++n){var o=i[n].data[0][1];o/s<=v.series.pie.combine.threshold&&(t+=o,r++,a||(a=i[n].color))}for(var n=0;n<i.length;++n){var o=i[n].data[0][1];(2>r||o/s>v.series.pie.combine.threshold)&&l.push(e.extend(i[n],{data:[[1,o]],color:i[n].color,label:i[n].label,angle:o*Math.PI*2/s,percent:o/(s/100)}))}return r>1&&l.push({data:[[1,t]],color:a,label:v.series.pie.combine.label,angle:t*Math.PI*2/s,percent:t/(s/100)}),l}(i.getData())))}function a(t,r){function a(){P.clearRect(0,0,p,h),f.children().filter(".pieLabel, .pieLabelBackground").remove()}function n(){var e=v.series.pie.shadow.left,i=v.series.pie.shadow.top,s=v.series.pie.shadow.alpha,t=v.series.pie.radius>1?v.series.pie.radius:b*v.series.pie.radius;if(!(t>=p/2-e||t*v.series.pie.tilt>=h/2-i||10>=t)){P.save(),P.translate(e,i),P.globalAlpha=s,P.fillStyle="#000",P.translate(w,k),P.scale(1,v.series.pie.tilt);for(var r=1;10>=r;r++)P.beginPath(),P.arc(0,0,t,0,2*Math.PI,!1),P.fill(),t-=r;P.restore()}}function o(){function i(e,i,s){0>=e||isNaN(e)||(s?P.fillStyle=i:(P.strokeStyle=i,P.lineJoin="round"),P.beginPath(),Math.abs(e-2*Math.PI)>1e-9&&P.moveTo(0,0),P.arc(0,0,t,r,r+e/2,!1),P.arc(0,0,t,r+e/2,r+e,!1),P.closePath(),r+=e,s?P.fill():P.stroke())}var s=Math.PI*v.series.pie.startAngle,t=v.series.pie.radius>1?v.series.pie.radius:b*v.series.pie.radius;P.save(),P.translate(w,k),P.scale(1,v.series.pie.tilt),P.save();for(var r=s,a=0;a<c.length;++a)c[a].startAngle=r,i(c[a].angle,c[a].color,!0);if(P.restore(),v.series.pie.stroke.width>0){for(P.save(),P.lineWidth=v.series.pie.stroke.width,r=s,a=0;a<c.length;++a)i(c[a].angle,v.series.pie.stroke.color,!1);P.restore()}return l(P),P.restore(),!v.series.pie.label.show||function(){function i(i,s,t){if(0==i.data[0][1])return!0;var a,l=v.legend.labelFormatter,n=v.series.pie.label.formatter;a=l?l(i.label,i):i.label,n&&(a=n(a,i));var o=(s+i.angle+s)/2,g=w+Math.round(Math.cos(o)*r),c=k+Math.round(Math.sin(o)*r)*v.series.pie.tilt,u="<span class='pieLabel' id='pieLabel"+t+"' style='position:absolute;top:"+c+"px;left:"+g+"px;'>"+a+"</span>";f.append(u);var d=f.children("#pieLabel"+t),b=c-d.height()/2,M=g-d.width()/2;if(d.css("top",b),d.css("left",M),0-b>0||0-M>0||h-(b+d.height())<0||p-(M+d.width())<0)return!1;if(0!=v.series.pie.label.background.opacity){var P=v.series.pie.label.background.color;null==P&&(P=i.color);var A="top:"+b+"px;left:"+M+"px;";e("<div class='pieLabelBackground' style='position:absolute;width:"+d.width()+"px;height:"+d.height()+"px;"+A+"background-color:"+P+";'></div>").css("opacity",v.series.pie.label.background.opacity).insertBefore(d)}return!0}for(var t=s,r=v.series.pie.label.radius>1?v.series.pie.label.radius:b*v.series.pie.label.radius,a=0;a<c.length;++a){if(c[a].percent>=100*v.series.pie.label.threshold&&!i(c[a],t,a))return!1;t+=c[a].angle}return!0}()}if(f){var p=t.getPlaceholder().width(),h=t.getPlaceholder().height(),g=f.children().filter(".legend").children().width()||0;P=r,M=!1,b=Math.min(p,h/v.series.pie.tilt)/2,k=h/2+v.series.pie.offset.top,w=p/2,"auto"==v.series.pie.offset.left?(v.legend.position.match("w")?w+=g/2:w-=g/2,b>w?w=b:w>p-b&&(w=p-b)):w+=v.series.pie.offset.left;var c=t.getData(),u=0;do{u>0&&(b*=s),u+=1,a(),v.series.pie.tilt<=.8&&n()}while(!o()&&i>u);u>=i&&(a(),f.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),t.setSeries&&t.insertLegend&&(t.setSeries(c),t.insertLegend())}}function l(e){if(v.series.pie.innerRadius>0){e.save();var i=v.series.pie.innerRadius>1?v.series.pie.innerRadius:b*v.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=v.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=v.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function n(e,i){for(var s=!1,t=-1,r=e.length,a=r-1;++t<r;a=t)(e[t][1]<=i[1]&&i[1]<e[a][1]||e[a][1]<=i[1]&&i[1]<e[t][1])&&i[0]<(e[a][0]-e[t][0])*(i[1]-e[t][1])/(e[a][1]-e[t][1])+e[t][0]&&(s=!s);return s}function o(e,i){for(var s,r,a=t.getData(),l=t.getOptions(),o=l.series.pie.radius>1?l.series.pie.radius:b*l.series.pie.radius,p=0;p<a.length;++p){var h=a[p];if(h.pie.show){if(P.save(),P.beginPath(),P.moveTo(0,0),P.arc(0,0,o,h.startAngle,h.startAngle+h.angle/2,!1),P.arc(0,0,o,h.startAngle+h.angle/2,h.startAngle+h.angle,!1),P.closePath(),s=e-w,r=i-k,P.isPointInPath){if(P.isPointInPath(e-w,i-k))return P.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:p}}else if(n([[0,0],[o*Math.cos(h.startAngle),o*Math.sin(h.startAngle)],[o*Math.cos(h.startAngle+h.angle/4),o*Math.sin(h.startAngle+h.angle/4)],[o*Math.cos(h.startAngle+h.angle/2),o*Math.sin(h.startAngle+h.angle/2)],[o*Math.cos(h.startAngle+h.angle/1.5),o*Math.sin(h.startAngle+h.angle/1.5)],[o*Math.cos(h.startAngle+h.angle),o*Math.sin(h.startAngle+h.angle)]],[s,r]))return P.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:p};P.restore()}}return null}function p(e){g("plothover",e)}function h(e){g("plotclick",e)}function g(e,i){var s=t.offset(),r=o(parseInt(i.pageX-s.left),parseInt(i.pageY-s.top));if(v.grid.autoHighlight)for(var a=0;a<A.length;++a){var l=A[a];l.auto!=e||r&&l.series==r.series||c(l.series)}r&&function(e,i){var s=u(e);-1==s?(A.push({series:e,auto:i}),t.triggerRedrawOverlay()):i||(A[s].auto=!1)}(r.series,e);var n={pageX:i.pageX,pageY:i.pageY};f.trigger(e,[n,r])}function c(e){null==e&&(A=[],t.triggerRedrawOverlay());var i=u(e);-1!=i&&(A.splice(i,1),t.triggerRedrawOverlay())}function u(e){for(var i=0;i<A.length;++i)if(A[i].series==e)return i;return-1}var d=null,f=null,v=null,b=null,w=null,k=null,M=!1,P=null,A=[];t.hooks.processOptions.push(function(e,i){i.series.pie.show&&(i.grid.show=!1,"auto"==i.series.pie.label.show&&(i.series.pie.label.show=!i.legend.show),"auto"==i.series.pie.radius&&(i.series.pie.radius=i.series.pie.label.show?.75:1),i.series.pie.tilt>1?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))}),t.hooks.bindEvents.push(function(e,i){var s=e.getOptions();s.series.pie.show&&(s.grid.hoverable&&i.unbind("mousemove").mousemove(p),s.grid.clickable&&i.unbind("click").click(h))}),t.hooks.processDatapoints.push(function(e,i,s,t){e.getOptions().series.pie.show&&r(e)}),t.hooks.drawOverlay.push(function(e,i){e.getOptions().series.pie.show&&function(e,i){function s(e){e.angle<=0||isNaN(e.angle)||(i.fillStyle="rgba(255, 255, 255, "+t.series.pie.highlight.opacity+")",i.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&i.moveTo(0,0),i.arc(0,0,r,e.startAngle,e.startAngle+e.angle/2,!1),i.arc(0,0,r,e.startAngle+e.angle/2,e.startAngle+e.angle,!1),i.closePath(),i.fill())}var t=e.getOptions(),r=t.series.pie.radius>1?t.series.pie.radius:b*t.series.pie.radius;i.save(),i.translate(w,k),i.scale(1,t.series.pie.tilt);for(var a=0;a<A.length;++a)s(A[a].series);l(i),i.restore()}(e,i)}),t.hooks.draw.push(function(e,i){e.getOptions().series.pie.show&&a(e,i)})},options:t,name:"pie",version:"1.1"})}(jQuery);