angular.module("signature",[]),angular.module("signature").directive("signaturePad",["$interval","$timeout","$window",function(A,w,a){"use strict";var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjgAAADcCAQAAADXNhPAAAACIklEQVR42u3UIQEAAAzDsM+/6UsYG0okFDQHMBIJAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHADDAQwHMBwAwwEMB8BwAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEwHMBwAMMBMBzAcAAMBzAcwHAADAcwHADDAQwHMBwAwwEMB8BwAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcCQADAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHMBwAAwHMBwAwwEMBzAcAMMBDAfAcADDAQwHwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHMBwAAwHMBwAwwEMB8BwAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDkQAwHMBwAAwHMBwAwwEMBzAcAMMBDAfAcADDAQwHwHAAwwEwHMBwAMMBMBzAcAAMBzAcwHAADAcwHADDAQwHMBwAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHMBwAAwHMBwAwwEMBzAcAMMBDAegeayZAN3dLgwnAAAAAElFTkSuQmCC";return{restrict:"EA",replace:!0,template:'<div class="signature" style="width: 100%; max-width:{{width}}px; height: 100%; max-height:{{height}}px;"><canvas style="display: block; margin: 0 auto;" ng-mouseup="onMouseup()" ng-mousedown="notifyDrawing({ drawing: true })"></canvas></div>',scope:{accept:"=?",clear:"=?",disabled:"=?",dataurl:"=?",height:"@",width:"@",notifyDrawing:"&onDrawing"},controller:["$scope",function(A){A.accept=function(){return{isEmpty:A.dataurl===t,dataUrl:A.dataurl}},A.onMouseup=function(){A.updateModel(),A.notifyDrawing({drawing:!1})},A.updateModel=function(){w().then(function(){A.dataurl=A.signaturePad.isEmpty()?t:A.signaturePad.toDataURL()})},A.clear=function(){A.signaturePad.clear(),A.dataurl=t},A.$watch("dataurl",function(w){w&&A.signaturePad.toDataURL()!==w&&A.setDataUrl(w)})}],link:function(t,n,e){var i=n.find("canvas")[0],c=i.parentElement,M=0,r=i.getContext("2d"),u=parseInt(t.width,10),B=parseInt(t.height,10);i.width=u,i.height=B,t.signaturePad=new SignaturePad(i),t.setDataUrl=function(A){var a=Math.max(window.devicePixelRatio||1,1);r.setTransform(1,0,0,1,0,0),r.scale(a,a),t.signaturePad.clear(),t.signaturePad.fromDataURL(A),w().then(function(){r.setTransform(1,0,0,1,0,0),r.scale(1/M,1/M)})},t.$watch("disabled",function(A){A?t.signaturePad.off():t.signaturePad.on()});var D=function(){var A=Math.min(c.clientWidth/u,1),w=Math.min(c.clientHeight/B,1),a=Math.min(A,w);if(a!==M){var t=u*a,n=B*a;i.style.height=Math.round(n)+"px",i.style.width=Math.round(t)+"px",M=a,r.setTransform(1,0,0,1,0,0),r.scale(1/M,1/M)}},o=A(D,200);t.$on("$destroy",function(){A.cancel(o),o=null}),angular.element(a).bind("resize",D),t.$on("$destroy",function(){angular.element(a).unbind("resize",D)}),D(),n.on("touchstart",function(A){t.$apply(function(){t.notifyDrawing({drawing:!0})}),A.preventDefault()}),n.on("touchend",function(A){t.$apply(function(){t.updateModel(),t.notifyDrawing({drawing:!1})}),A.preventDefault()})}}}]),angular.module("ngSignaturePad",["signature"]);